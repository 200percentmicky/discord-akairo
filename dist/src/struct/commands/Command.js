"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const AkairoError_1 = __importDefault(require("../../util/AkairoError"));
const AkairoModule_1 = __importDefault(require("../AkairoModule"));
const Argument_1 = __importDefault(require("./arguments/Argument"));
const ArgumentRunner_1 = __importDefault(require("./arguments/ArgumentRunner"));
const ContentParser_1 = __importDefault(require("./ContentParser"));
/**
 * Represents a command.
 * @param id - Command ID.
 * @param options - Options for the command.
 */
class Command extends AkairoModule_1.default {
    constructor(id, options) {
        super(id, { category: options?.category });
        const { onlyNsfw = false, aliases = [], 
        // @ts-expect-error: otherwise generator functions break
        args = this.args || [], quoted = true, separator, channel = null, ownerOnly = false, superUserOnly = false, editable = true, typing = false, cooldown = null, ratelimit = 1, argumentDefaults = {}, description = "", prefix = this.prefix, // @ts-expect-error
        clientPermissions = this.clientPermissions, // @ts-expect-error
        userPermissions = this.userPermissions, // @ts-expect-error
        regex = this.regex, 
        // @ts-expect-error
        condition = this.condition || (() => false), before = this.before || (() => undefined), lock, ignoreCooldown, ignorePermissions, flags = [], optionFlags = [], slash = false, slashOptions, slashEphemeral = false, slashGuilds = [] } = options ?? {};
        this.aliases = aliases ?? [];
        const { flagWords, optionFlagWords } = Array.isArray(args)
            ? ContentParser_1.default.getFlags(args)
            : { flagWords: flags, optionFlagWords: optionFlags };
        this.contentParser = new ContentParser_1.default({
            flagWords,
            optionFlagWords,
            quoted,
            separator
        });
        this.argumentRunner = new ArgumentRunner_1.default(this);
        this.argumentGenerator = (Array.isArray(args)
            ? ArgumentRunner_1.default.fromArguments(
            // @ts-expect-error
            args.map(arg => [arg.id, new Argument_1.default(this, arg)]))
            : args.bind(this));
        this.onlyNsfw = Boolean(onlyNsfw);
        this.channel = channel;
        this.ownerOnly = Boolean(ownerOnly);
        this.superUserOnly = Boolean(superUserOnly);
        this.editable = Boolean(editable);
        this.typing = Boolean(typing);
        this.cooldown = cooldown;
        this.ratelimit = ratelimit;
        this.argumentDefaults = argumentDefaults;
        this.description = Array.isArray(description) ? description.join("\n") : description;
        this.prefix = typeof prefix === "function" ? prefix.bind(this) : prefix;
        this.clientPermissions = typeof clientPermissions === "function" ? clientPermissions.bind(this) : clientPermissions;
        this.userPermissions = typeof userPermissions === "function" ? userPermissions.bind(this) : userPermissions;
        this.regex = typeof regex === "function" ? regex.bind(this) : regex;
        this.condition = condition.bind(this);
        this.before = before.bind(this);
        this.lock = lock;
        if (typeof lock === "string") {
            this.lock = {
                guild: (message) => message.guild && message.guild.id,
                channel: (message) => message.channel.id,
                user: (message) => message.author.id
            }[lock];
        }
        if (this.lock) {
            this.locker = new Set();
        }
        this.ignoreCooldown = typeof ignoreCooldown === "function" ? ignoreCooldown.bind(this) : ignoreCooldown;
        this.ignorePermissions = typeof ignorePermissions === "function" ? ignorePermissions.bind(this) : ignorePermissions;
        this.slashOptions = slashOptions;
        this.slashEphemeral = slashEphemeral;
        this.slash = slash;
        this.slashGuilds = slashGuilds;
    }
    /**
     * Command names.
     */
    aliases;
    /**
     * Default prompt options.
     */
    argumentDefaults;
    /**
     * Usable only in this channel type.
     */
    channel;
    /**
     * Permissions required to run command by the client.
     */
    clientPermissions;
    /**
     * Cooldown in milliseconds.
     */
    cooldown;
    /**
     * Description of the command.
     */
    description;
    /**
     * Whether or not this command can be ran by an edit.
     */
    editable;
    /**
     * ID of user(s) to ignore cooldown or a function to ignore.
     */
    ignoreCooldown;
    /**
     * ID of user(s) to ignore `userPermissions` checks or a function to ignore.
     */
    ignorePermissions;
    /**
     * The key supplier for the locker.
     */
    lock;
    /**
     * Stores the current locks.
     */
    locker;
    /**
     * Whether or not the command can only be run in  NSFW channels.
     */
    onlyNsfw;
    /**
     * Usable only by the client owner.
     */
    ownerOnly;
    /**
     * Command prefix overwrite.
     */
    prefix;
    /**
     * Whether or not to consider quotes.
     */
    quoted;
    /**
     * Uses allowed before cooldown.
     */
    ratelimit;
    /**
     * The regex trigger for this command.
     */
    regex;
    /**
     * Mark command as slash command and set information.
     */
    slash;
    /**
     * Whether slash command responses for this command should be ephemeral or not.
     */
    slashEphemeral;
    /**
     * Assign slash commands to Specific guilds. This option will make the commands not register globally, but only in the chosen servers.
     */
    slashGuilds;
    /**
     * Options for using the slash command.
     */
    slashOptions;
    /**
     * Whether or not to allow client superUsers(s) only.
     */
    superUserOnly;
    /**
     * Whether or not to type during command execution.
     */
    typing;
    /**
     * Permissions required to run command by the user.
     */
    userPermissions;
    /**
     * Argument options or generator.
     */
    // public args: ArgumentOptions[] | ArgumentGenerator;
    /**
     * The content parser.
     */
    contentParser;
    /**
     * The argument runner.
     */
    argumentRunner;
    /**
     * Generator for arguments.
     */
    argumentGenerator;
    /**
     * Executes the command.
     * @param message - Message that triggered the command.
     * @param args - Evaluated arguments.
     */
    /* public exec(message: Message, args: any): any; */
    exec(message, args) {
        throw new AkairoError_1.default("NOT_IMPLEMENTED", this.constructor.name, "exec");
    }
    /**
     * Runs before argument parsing and execution.
     * @param message - Message being handled.
     */
    before(message) { }
    /**
     * Checks if the command should be ran by using an arbitrary condition.
     * @param message - Message being handled.
     */
    // @ts-expect-error
    condition(message) { }
    /**
     * Execute the slash command
     * @param message - Message for slash command
     * @param args - Slash command options
     */
    execSlash(message, ...args) {
        if (this.slash) {
            throw new AkairoError_1.default("NOT_IMPLEMENTED", this.constructor.name, "execSlash");
        }
    }
    /**
     * Parses content using the command's arguments.
     * @param message - Message to use.
     * @param content - String to parse.
     */
    parse(message, content) {
        const parsed = this.contentParser.parse(content);
        return this.argumentRunner.run(message, parsed, this.argumentGenerator);
    }
    /**
     * Reloads the command.
     */
    reload() {
        return super.reload();
    }
    /**
     * Removes the command.
     */
    remove() {
        return super.remove();
    }
}
exports.default = Command;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tbWFuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9zdHJ1Y3QvY29tbWFuZHMvQ29tbWFuZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLHlFQUFpRDtBQUlqRCxtRUFBb0U7QUFDcEUsb0VBQXlGO0FBQ3pGLGdGQUFpRjtBQUVqRixvRUFBcUU7QUFHckU7Ozs7R0FJRztBQUNILE1BQThCLE9BQVEsU0FBUSxzQkFBWTtJQUN6RCxZQUFZLEVBQVUsRUFBRSxPQUF3QjtRQUMvQyxLQUFLLENBQUMsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBRTNDLE1BQU0sRUFDTCxRQUFRLEdBQUcsS0FBSyxFQUNoQixPQUFPLEdBQUcsRUFBRTtRQUNaLHdEQUF3RDtRQUN4RCxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxFQUFFLEVBQ3RCLE1BQU0sR0FBRyxJQUFJLEVBQ2IsU0FBUyxFQUNULE9BQU8sR0FBRyxJQUFLLEVBQ2YsU0FBUyxHQUFHLEtBQUssRUFDakIsYUFBYSxHQUFHLEtBQUssRUFDckIsUUFBUSxHQUFHLElBQUksRUFDZixNQUFNLEdBQUcsS0FBSyxFQUNkLFFBQVEsR0FBRyxJQUFLLEVBQ2hCLFNBQVMsR0FBRyxDQUFDLEVBQ2IsZ0JBQWdCLEdBQUcsRUFBRSxFQUNyQixXQUFXLEdBQUcsRUFBRSxFQUNoQixNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxtQkFBbUI7UUFDekMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFLG1CQUFtQjtRQUMvRCxlQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxtQkFBbUI7UUFDM0QsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLO1FBQ2xCLG1CQUFtQjtRQUNuQixTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FB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c2xpbnQvbm8tdW51c2VkLXZhcnMgKi9cbmltcG9ydCB7IEFwcGxpY2F0aW9uQ29tbWFuZE9wdGlvbkRhdGEsIE1lc3NhZ2UsIFBlcm1pc3Npb25SZXNvbHZhYmxlLCBTbm93Zmxha2UgfSBmcm9tIFwiZGlzY29yZC5qc1wiO1xuaW1wb3J0IEFrYWlyb0Vycm9yIGZyb20gXCIuLi8uLi91dGlsL0FrYWlyb0Vycm9yXCI7XG5pbXBvcnQgQWthaXJvTWVzc2FnZSBmcm9tIFwiLi4vLi4vdXRpbC9Ba2Fpcm9NZXNzYWdlXCI7XG5pbXBvcnQgQ2F0ZWdvcnkgZnJvbSBcIi4uLy4uL3V0aWwvQ2F0ZWdvcnlcIjtcbmltcG9ydCBBa2Fpcm9DbGllbnQgZnJvbSBcIi4uL0FrYWlyb0NsaWVudFwiO1xuaW1wb3J0IEFrYWlyb01vZHVsZSwgeyBBa2Fpcm9Nb2R1bGVPcHRpb25zIH0gZnJvbSBcIi4uL0FrYWlyb01vZHVsZVwiO1xuaW1wb3J0IEFyZ3VtZW50LCB7IEFyZ3VtZW50T3B0aW9ucywgRGVmYXVsdEFyZ3VtZW50T3B0aW9ucyB9IGZyb20gXCIuL2FyZ3VtZW50cy9Bcmd1bWVudFwiO1xuaW1wb3J0IEFyZ3VtZW50UnVubmVyLCB7IEFyZ3VtZW50UnVubmVyU3RhdGUgfSBmcm9tIFwiLi9hcmd1bWVudHMvQXJndW1lbnRSdW5uZXJcIjtcbmltcG9ydCBDb21tYW5kSGFuZGxlciwgeyBJZ25vcmVDaGVja1ByZWRpY2F0ZSwgUHJlZml4U3VwcGxpZXIgfSBmcm9tIFwiLi9Db21tYW5kSGFuZGxlclwiO1xuaW1wb3J0IENvbnRlbnRQYXJzZXIsIHsgQ29udGVudFBhcnNlclJlc3VsdCB9IGZyb20gXCIuL0NvbnRlbnRQYXJzZXJcIjtcbmltcG9ydCBGbGFnIGZyb20gXCIuL0ZsYWdcIjtcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgY29tbWFuZC5cbiAqIEBwYXJhbSBpZCAtIENvbW1hbmQgSUQuXG4gKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbnMgZm9yIHRoZSBjb21tYW5kLlxuICovXG5leHBvcnQgZGVmYXVsdCBhYnN0cmFjdCBjbGFzcyBDb21tYW5kIGV4dGVuZHMgQWthaXJvTW9kdWxlIHtcblx0Y29uc3RydWN0b3IoaWQ6IHN0cmluZywgb3B0aW9ucz86IENvbW1hbmRPcHRpb25zKSB7XG5cdFx0c3VwZXIoaWQsIHsgY2F0ZWdvcnk6IG9wdGlvbnM/LmNhdGVnb3J5IH0pO1xuXG5cdFx0Y29uc3Qge1xuXHRcdFx0b25seU5zZncgPSBmYWxzZSxcblx0XHRcdGFsaWFzZXMgPSBbXSxcblx0XHRcdC8vIEB0cy1leHBlY3QtZXJyb3I6IG90aGVyd2lzZSBnZW5lcmF0b3IgZnVuY3Rpb25zIGJyZWFrXG5cdFx0XHRhcmdzID0gdGhpcy5hcmdzIHx8IFtdLFxuXHRcdFx0cXVvdGVkID0gdHJ1ZSxcblx0XHRcdHNlcGFyYXRvcixcblx0XHRcdGNoYW5uZWwgPSBudWxsISxcblx0XHRcdG93bmVyT25seSA9IGZhbHNlLFxuXHRcdFx0c3VwZXJVc2VyT25seSA9IGZhbHNlLFxuXHRcdFx0ZWRpdGFibGUgPSB0cnVlLFxuXHRcdFx0dHlwaW5nID0gZmFsc2UsXG5cdFx0XHRjb29sZG93biA9IG51bGwhLFxuXHRcdFx0cmF0ZWxpbWl0ID0gMSxcblx0XHRcdGFyZ3VtZW50RGVmYXVsdHMgPSB7fSxcblx0XHRcdGRlc2NyaXB0aW9uID0gXCJcIixcblx0XHRcdHByZWZpeCA9IHRoaXMucHJlZml4LCAvLyBAdHMtZXhwZWN0LWVycm9yXG5cdFx0XHRjbGllbnRQZXJtaXNzaW9ucyA9IHRoaXMuY2xpZW50UGVybWlzc2lvbnMsIC8vIEB0cy1leHBlY3QtZXJyb3Jcblx0XHRcdHVzZXJQZXJtaXNzaW9ucyA9IHRoaXMudXNlclBlcm1pc3Npb25zLCAvLyBAdHMtZXhwZWN0LWVycm9yXG5cdFx0XHRyZWdleCA9IHRoaXMucmVnZXgsXG5cdFx0XHQvLyBAdHMtZXhwZWN0LWVycm9yXG5cdFx0XHRjb25kaXRpb24gPSB0aGlzLmNvbmRpdGlvbiB8fCAoKCkgPT4gZmFsc2UpLFxuXHRcdFx0YmVmb3JlID0gdGhpcy5iZWZvcmUgfHwgKCgpID0+IHVuZGVmaW5lZCksXG5cdFx0XHRsb2NrLFxuXHRcdFx0aWdub3JlQ29vbGRvd24sXG5cdFx0XHRpZ25vcmVQZXJtaXNzaW9ucyxcblx0XHRcdGZsYWdzID0gW10sXG5cdFx0XHRvcHRpb25GbGFncyA9IFtdLFxuXHRcdFx0c2xhc2ggPSBmYWxzZSxcblx0XHRcdHNsYXNoT3B0aW9ucyxcblx0XHRcdHNsYXNoRXBoZW1lcmFsID0gZmFsc2UsXG5cdFx0XHRzbGFzaEd1aWxkcyA9IFtdXG5cdFx0fTogQ29tbWFuZE9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuXG5cdFx0dGhpcy5hbGlhc2VzID0gYWxpYXNlcyA/PyBbXTtcblxuXHRcdGNvbnN0IHsgZmxhZ1dvcmRzLCBvcHRpb25GbGFnV29yZHMgfSA9IEFycmF5LmlzQXJyYXkoYXJncylcblx0XHRcdD8gQ29udGVudFBhcnNlci5nZXRGbGFncyhhcmdzKVxuXHRcdFx0OiB7IGZsYWdXb3JkczogZmxhZ3MsIG9wdGlvbkZsYWdXb3Jkczogb3B0aW9uRmxhZ3MgfTtcblxuXHRcdHRoaXMuY29udGVudFBhcnNlciA9IG5ldyBDb250ZW50UGFyc2VyKHtcblx0XHRcdGZsYWdXb3Jkcyxcblx0XHRcdG9wdGlvbkZsYWdXb3Jkcyxcblx0XHRcdHF1b3RlZCxcblx0XHRcdHNlcGFyYXRvclxuXHRcdH0pO1xuXG5cdFx0dGhpcy5hcmd1bWVudFJ1bm5lciA9IG5ldyBBcmd1bWVudFJ1bm5lcih0aGlzKTtcblx0XHR0aGlzLmFyZ3VtZW50R2VuZXJhdG9yID0gKFxuXHRcdFx0QXJyYXkuaXNBcnJheShhcmdzKVxuXHRcdFx0XHQ/IEFyZ3VtZW50UnVubmVyLmZyb21Bcmd1bWVudHMoXG5cdFx0XHRcdFx0XHQvLyBAdHMtZXhwZWN0LWVycm9yXG5cdFx0XHRcdFx0XHRhcmdzLm1hcChhcmcgPT4gW2FyZy5pZCwgbmV3IEFyZ3VtZW50KHRoaXMsIGFyZyldKVxuXHRcdFx0XHQgIClcblx0XHRcdFx0OiBhcmdzLmJpbmQodGhpcylcblx0XHQpIGFzIEFyZ3VtZW50R2VuZXJhdG9yO1xuXG5cdFx0dGhpcy5vbmx5TnNmdyA9IEJvb2xlYW4ob25seU5zZncpO1xuXG5cdFx0dGhpcy5jaGFubmVsID0gY2hhbm5lbCE7XG5cblx0XHR0aGlzLm93bmVyT25seSA9IEJvb2xlYW4ob3duZXJPbmx5KTtcblxuXHRcdHRoaXMuc3VwZXJVc2VyT25seSA9IEJvb2xlYW4oc3VwZXJVc2VyT25seSk7XG5cblx0XHR0aGlzLmVkaXRhYmxlID0gQm9vbGVhbihlZGl0YWJsZSk7XG5cblx0XHR0aGlzLnR5cGluZyA9IEJvb2xlYW4odHlwaW5nKTtcblxuXHRcdHRoaXMuY29vbGRvd24gPSBjb29sZG93biE7XG5cblx0XHR0aGlzLnJhdGVsaW1pdCA9IHJhdGVsaW1pdDtcblxuXHRcdHRoaXMuYXJndW1lbnREZWZhdWx0cyA9IGFyZ3VtZW50RGVmYXVsdHM7XG5cblx0XHR0aGlzLmRlc2NyaXB0aW9uID0gQXJyYXkuaXNBcnJheShkZXNjcmlwdGlvbikgPyBkZXNjcmlwdGlvbi5qb2luKFwiXFxuXCIpIDogZGVzY3JpcHRpb247XG5cblx0XHR0aGlzLnByZWZpeCA9IHR5cGVvZiBwcmVmaXggPT09IFwiZnVuY3Rpb25cIiA/IHByZWZpeC5iaW5kKHRoaXMpIDogcHJlZml4O1xuXG5cdFx0dGhpcy5jbGllbnRQZXJtaXNzaW9ucyA9IHR5cGVvZiBjbGllbnRQZXJtaXNzaW9ucyA9PT0gXCJmdW5jdGlvblwiID8gY2xpZW50UGVybWlzc2lvbnMuYmluZCh0aGlzKSA6IGNsaWVudFBlcm1pc3Npb25zO1xuXG5cdFx0dGhpcy51c2VyUGVybWlzc2lvbnMgPSB0eXBlb2YgdXNlclBlcm1pc3Npb25zID09PSBcImZ1bmN0aW9uXCIgPyB1c2VyUGVybWlzc2lvbnMuYmluZCh0aGlzKSA6IHVzZXJQZXJtaXNzaW9ucztcblxuXHRcdHRoaXMucmVnZXggPSB0eXBlb2YgcmVnZXggPT09IFwiZnVuY3Rpb25cIiA/IHJlZ2V4LmJpbmQodGhpcykgOiByZWdleDtcblxuXHRcdHRoaXMuY29uZGl0aW9uID0gY29uZGl0aW9uLmJpbmQodGhpcyk7XG5cblx0XHR0aGlzLmJlZm9yZSA9IGJlZm9yZS5iaW5kKHRoaXMpO1xuXG5cdFx0dGhpcy5sb2NrID0gbG9jaztcblxuXHRcdGlmICh0eXBlb2YgbG9jayA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0dGhpcy5sb2NrID0ge1xuXHRcdFx0XHRndWlsZDogKG1lc3NhZ2U6IE1lc3NhZ2UgfCBBa2Fpcm9NZXNzYWdlKTogc3RyaW5nID0+IG1lc3NhZ2UuZ3VpbGQhICYmIG1lc3NhZ2UuZ3VpbGQuaWQhLFxuXHRcdFx0XHRjaGFubmVsOiAobWVzc2FnZTogTWVzc2FnZSB8IEFrYWlyb01lc3NhZ2UpOiBzdHJpbmcgPT4gbWVzc2FnZS5jaGFubmVsIS5pZCxcblx0XHRcdFx0dXNlcjogKG1lc3NhZ2U6IE1lc3NhZ2UgfCBBa2Fpcm9NZXNzYWdlKTogc3RyaW5nID0+IG1lc3NhZ2UuYXV0aG9yLmlkXG5cdFx0XHR9W2xvY2tdO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLmxvY2spIHtcblx0XHRcdHRoaXMubG9ja2VyID0gbmV3IFNldCgpO1xuXHRcdH1cblxuXHRcdHRoaXMuaWdub3JlQ29vbGRvd24gPSB0eXBlb2YgaWdub3JlQ29vbGRvd24gPT09IFwiZnVuY3Rpb25cIiA/IGlnbm9yZUNvb2xkb3duLmJpbmQodGhpcykgOiBpZ25vcmVDb29sZG93bjtcblxuXHRcdHRoaXMuaWdub3JlUGVybWlzc2lvbnMgPSB0eXBlb2YgaWdub3JlUGVybWlzc2lvbnMgPT09IFwiZnVuY3Rpb25cIiA/IGlnbm9yZVBlcm1pc3Npb25zLmJpbmQodGhpcykgOiBpZ25vcmVQZXJtaXNzaW9ucztcblxuXHRcdHRoaXMuc2xhc2hPcHRpb25zID0gc2xhc2hPcHRpb25zO1xuXG5cdFx0dGhpcy5zbGFzaEVwaGVtZXJhbCA9IHNsYXNoRXBoZW1lcmFsO1xuXG5cdFx0dGhpcy5zbGFzaCA9IHNsYXNoO1xuXG5cdFx0dGhpcy5zbGFzaEd1aWxkcyA9IHNsYXNoR3VpbGRzO1xuXHR9XG5cblx0LyoqXG5cdCAqIENvbW1hbmQgbmFtZXMuXG5cdCAqL1xuXHRwdWJsaWMgYWxpYXNlczogc3RyaW5nW107XG5cblx0LyoqXG5cdCAqIERlZmF1bHQgcHJvbXB0IG9wdGlvbnMuXG5cdCAqL1xuXHRwdWJsaWMgYXJndW1lbnREZWZhdWx0czogRGVmYXVsdEFyZ3VtZW50T3B0aW9ucztcblxuXHQvKipcblx0ICogQ2F0ZWdvcnkgdGhlIGNvbW1hbmQgYmVsb25ncyB0by5cblx0ICovXG5cdHB1YmxpYyBkZWNsYXJlIGNhdGVnb3J5OiBDYXRlZ29yeTxzdHJpbmcsIENvbW1hbmQ+O1xuXG5cdC8qKlxuXHQgKiBVc2FibGUgb25seSBpbiB0aGlzIGNoYW5uZWwgdHlwZS5cblx0ICovXG5cdHB1YmxpYyBjaGFubmVsPzogc3RyaW5nO1xuXG5cdC8qKlxuXHQgKiBUaGUgQWthaXJvIGNsaWVudC5cblx0ICovXG5cdHB1YmxpYyBkZWNsYXJlIGNsaWVudDogQWthaXJvQ2xpZW50O1xuXG5cdC8qKlxuXHQgKiBQZXJtaXNzaW9ucyByZXF1aXJlZCB0byBydW4gY29tbWFuZCBieSB0aGUgY2xpZW50LlxuXHQgKi9cblx0cHVibGljIGNsaWVudFBlcm1pc3Npb25zOiBQZXJtaXNzaW9uUmVzb2x2YWJsZSB8IFBlcm1pc3Npb25SZXNvbHZhYmxlW10gfCBNaXNzaW5nUGVybWlzc2lvblN1cHBsaWVyO1xuXG5cdC8qKlxuXHQgKiBDb29sZG93biBpbiBtaWxsaXNlY29uZHMuXG5cdCAqL1xuXHRwdWJsaWMgY29vbGRvd24/OiBudW1iZXI7XG5cblx0LyoqXG5cdCAqIERlc2NyaXB0aW9uIG9mIHRoZSBjb21tYW5kLlxuXHQgKi9cblx0cHVibGljIGRlc2NyaXB0aW9uOiBhbnk7XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IHRoaXMgY29tbWFuZCBjYW4gYmUgcmFuIGJ5IGFuIGVkaXQuXG5cdCAqL1xuXHRwdWJsaWMgZWRpdGFibGU6IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIFRoZSBmaWxlcGF0aC5cblx0ICovXG5cdHB1YmxpYyBkZWNsYXJlIGZpbGVwYXRoOiBzdHJpbmc7XG5cblx0LyoqXG5cdCAqIFRoZSBoYW5kbGVyLlxuXHQgKi9cblx0cHVibGljIGRlY2xhcmUgaGFuZGxlcjogQ29tbWFuZEhhbmRsZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBJRCBvZiB0aGUgY29tbWFuZC5cblx0ICovXG5cdHB1YmxpYyBkZWNsYXJlIGlkOiBzdHJpbmc7XG5cblx0LyoqXG5cdCAqIElEIG9mIHVzZXIocykgdG8gaWdub3JlIGNvb2xkb3duIG9yIGEgZnVuY3Rpb24gdG8gaWdub3JlLlxuXHQgKi9cblx0cHVibGljIGlnbm9yZUNvb2xkb3duPzogU25vd2ZsYWtlIHwgU25vd2ZsYWtlW10gfCBJZ25vcmVDaGVja1ByZWRpY2F0ZTtcblxuXHQvKipcblx0ICogSUQgb2YgdXNlcihzKSB0byBpZ25vcmUgYHVzZXJQZXJtaXNzaW9uc2AgY2hlY2tzIG9yIGEgZnVuY3Rpb24gdG8gaWdub3JlLlxuXHQgKi9cblx0cHVibGljIGlnbm9yZVBlcm1pc3Npb25zPzogU25vd2ZsYWtlIHwgU25vd2ZsYWtlW10gfCBJZ25vcmVDaGVja1ByZWRpY2F0ZTtcblxuXHQvKipcblx0ICogVGhlIGtleSBzdXBwbGllciBmb3IgdGhlIGxvY2tlci5cblx0ICovXG5cdHB1YmxpYyBsb2NrPzogS2V5U3VwcGxpZXIgfCBcImNoYW5uZWxcIiB8IFwiZ3VpbGRcIiB8IFwidXNlclwiO1xuXG5cdC8qKlxuXHQgKiBTdG9yZXMgdGhlIGN1cnJlbnQgbG9ja3MuXG5cdCAqL1xuXHRwdWJsaWMgbG9ja2VyPzogU2V0PHN0cmluZz47XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IHRoZSBjb21tYW5kIGNhbiBvbmx5IGJlIHJ1biBpbiAgTlNGVyBjaGFubmVscy5cblx0ICovXG5cdHB1YmxpYyBvbmx5TnNmdzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogVXNhYmxlIG9ubHkgYnkgdGhlIGNsaWVudCBvd25lci5cblx0ICovXG5cdHB1YmxpYyBvd25lck9ubHk6IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIENvbW1hbmQgcHJlZml4IG92ZXJ3cml0ZS5cblx0ICovXG5cdHB1YmxpYyBwcmVmaXg/OiBzdHJpbmcgfCBzdHJpbmdbXSB8IFByZWZpeFN1cHBsaWVyO1xuXG5cdC8qKlxuXHQgKiBXaGV0aGVyIG9yIG5vdCB0byBjb25zaWRlciBxdW90ZXMuXG5cdCAqL1xuXHRwdWJsaWMgcXVvdGVkITogYm9vbGVhbjtcblxuXHQvKipcblx0ICogVXNlcyBhbGxvd2VkIGJlZm9yZSBjb29sZG93bi5cblx0ICovXG5cdHB1YmxpYyByYXRlbGltaXQ6IG51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIHJlZ2V4IHRyaWdnZXIgZm9yIHRoaXMgY29tbWFuZC5cblx0ICovXG5cdHB1YmxpYyByZWdleDogUmVnRXhwIHwgUmVnZXhTdXBwbGllcjtcblxuXHQvKipcblx0ICogTWFyayBjb21tYW5kIGFzIHNsYXNoIGNvbW1hbmQgYW5kIHNldCBpbmZvcm1hdGlvbi5cblx0ICovXG5cdHB1YmxpYyBzbGFzaD86IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgc2xhc2ggY29tbWFuZCByZXNwb25zZXMgZm9yIHRoaXMgY29tbWFuZCBzaG91bGQgYmUgZXBoZW1lcmFsIG9yIG5vdC5cblx0ICovXG5cdHB1YmxpYyBzbGFzaEVwaGVtZXJhbD86IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIEFzc2lnbiBzbGFzaCBjb21tYW5kcyB0byBTcGVjaWZpYyBndWlsZHMuIFRoaXMgb3B0aW9uIHdpbGwgbWFrZSB0aGUgY29tbWFuZHMgbm90IHJlZ2lzdGVyIGdsb2JhbGx5LCBidXQgb25seSBpbiB0aGUgY2hvc2VuIHNlcnZlcnMuXG5cdCAqL1xuXHRwdWJsaWMgc2xhc2hHdWlsZHM/OiBTbm93Zmxha2VbXTtcblxuXHQvKipcblx0ICogT3B0aW9ucyBmb3IgdXNpbmcgdGhlIHNsYXNoIGNvbW1hbmQuXG5cdCAqL1xuXHRwdWJsaWMgc2xhc2hPcHRpb25zPzogQXBwbGljYXRpb25Db21tYW5kT3B0aW9uRGF0YVtdO1xuXG5cdC8qKlxuXHQgKiBXaGV0aGVyIG9yIG5vdCB0byBhbGxvdyBjbGllbnQgc3VwZXJVc2VycyhzKSBvbmx5LlxuXHQgKi9cblx0cHVibGljIHN1cGVyVXNlck9ubHk6IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IHRvIHR5cGUgZHVyaW5nIGNvbW1hbmQgZXhlY3V0aW9uLlxuXHQgKi9cblx0cHVibGljIHR5cGluZzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogUGVybWlzc2lvbnMgcmVxdWlyZWQgdG8gcnVuIGNvbW1hbmQgYnkgdGhlIHVzZXIuXG5cdCAqL1xuXHRwdWJsaWMgdXNlclBlcm1pc3Npb25zOiBQZXJtaXNzaW9uUmVzb2x2YWJsZSB8IFBlcm1pc3Npb25SZXNvbHZhYmxlW10gfCBNaXNzaW5nUGVybWlzc2lvblN1cHBsaWVyO1xuXG5cdC8qKlxuXHQgKiBBcmd1bWVudCBvcHRpb25zIG9yIGdlbmVyYXRvci5cblx0ICovXG5cdC8vIHB1YmxpYyBhcmdzOiBBcmd1bWVudE9wdGlvbnNbXSB8IEFyZ3VtZW50R2VuZXJhdG9yO1xuXG5cdC8qKlxuXHQgKiBUaGUgY29udGVudCBwYXJzZXIuXG5cdCAqL1xuXHRwdWJsaWMgY29udGVudFBhcnNlcjogQ29udGVudFBhcnNlcjtcblxuXHQvKipcblx0ICogVGhlIGFyZ3VtZW50IHJ1bm5lci5cblx0ICovXG5cdHB1YmxpYyBhcmd1bWVudFJ1bm5lcjogQXJndW1lbnRSdW5uZXI7XG5cblx0LyoqXG5cdCAqIEdlbmVyYXRvciBmb3IgYXJndW1lbnRzLlxuXHQgKi9cblx0cHVibGljIGFyZ3VtZW50R2VuZXJhdG9yOiBBcmd1bWVudEdlbmVyYXRvcjtcblxuXHQvKipcblx0ICogRXhlY3V0ZXMgdGhlIGNvbW1hbmQuXG5cdCAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSB0aGF0IHRyaWdnZXJlZCB0aGUgY29tbWFuZC5cblx0ICogQHBhcmFtIGFyZ3MgLSBFdmFsdWF0ZWQgYXJndW1lbnRzLlxuXHQgKi9cblx0LyogcHVibGljIGV4ZWMobWVzc2FnZTogTWVzc2FnZSwgYXJnczogYW55KTogYW55OyAqL1xuXHRwdWJsaWMgZXhlYyhtZXNzYWdlOiBNZXNzYWdlIHwgQWthaXJvTWVzc2FnZSwgYXJnczogYW55KTogYW55IHtcblx0XHR0aHJvdyBuZXcgQWthaXJvRXJyb3IoXCJOT1RfSU1QTEVNRU5URURcIiwgdGhpcy5jb25zdHJ1Y3Rvci5uYW1lLCBcImV4ZWNcIik7XG5cdH1cblxuXHQvKipcblx0ICogUnVucyBiZWZvcmUgYXJndW1lbnQgcGFyc2luZyBhbmQgZXhlY3V0aW9uLlxuXHQgKiBAcGFyYW0gbWVzc2FnZSAtIE1lc3NhZ2UgYmVpbmcgaGFuZGxlZC5cblx0ICovXG5cdHB1YmxpYyBiZWZvcmUobWVzc2FnZTogTWVzc2FnZSk6IGFueSB7fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgdGhlIGNvbW1hbmQgc2hvdWxkIGJlIHJhbiBieSB1c2luZyBhbiBhcmJpdHJhcnkgY29uZGl0aW9uLlxuXHQgKiBAcGFyYW0gbWVzc2FnZSAtIE1lc3NhZ2UgYmVpbmcgaGFuZGxlZC5cblx0ICovXG5cdC8vIEB0cy1leHBlY3QtZXJyb3Jcblx0cHVibGljIGNvbmRpdGlvbihtZXNzYWdlOiBNZXNzYWdlKTogYm9vbGVhbiB8IFByb21pc2U8Ym9vbGVhbj4ge31cblxuXHQvKipcblx0ICogRXhlY3V0ZSB0aGUgc2xhc2ggY29tbWFuZFxuXHQgKiBAcGFyYW0gbWVzc2FnZSAtIE1lc3NhZ2UgZm9yIHNsYXNoIGNvbW1hbmRcblx0ICogQHBhcmFtIGFyZ3MgLSBTbGFzaCBjb21tYW5kIG9wdGlvbnNcblx0ICovXG5cdHB1YmxpYyBleGVjU2xhc2gobWVzc2FnZTogQWthaXJvTWVzc2FnZSwgLi4uYXJnczogYW55W10pOiBhbnkge1xuXHRcdGlmICh0aGlzLnNsYXNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgQWthaXJvRXJyb3IoXCJOT1RfSU1QTEVNRU5URURcIiwgdGhpcy5jb25zdHJ1Y3Rvci5uYW1lLCBcImV4ZWNTbGFzaFwiKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogUGFyc2VzIGNvbnRlbnQgdXNpbmcgdGhlIGNvbW1hbmQncyBhcmd1bWVudHMuXG5cdCAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSB0byB1c2UuXG5cdCAqIEBwYXJhbSBjb250ZW50IC0gU3RyaW5nIHRvIHBhcnNlLlxuXHQgKi9cblx0cHVibGljIHBhcnNlKG1lc3NhZ2U6IE1lc3NhZ2UsIGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8RmxhZyB8IGFueT4ge1xuXHRcdGNvbnN0IHBhcnNlZCA9IHRoaXMuY29udGVudFBhcnNlci5wYXJzZShjb250ZW50KTtcblx0XHRyZXR1cm4gdGhpcy5hcmd1bWVudFJ1bm5lci5ydW4obWVzc2FnZSwgcGFyc2VkLCB0aGlzLmFyZ3VtZW50R2VuZXJhdG9yKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZWxvYWRzIHRoZSBjb21tYW5kLlxuXHQgKi9cblx0cHVibGljIG92ZXJyaWRlIHJlbG9hZCgpOiBDb21tYW5kIHtcblx0XHRyZXR1cm4gc3VwZXIucmVsb2FkKCkgYXMgQ29tbWFuZDtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZW1vdmVzIHRoZSBjb21tYW5kLlxuXHQgKi9cblx0cHVibGljIG92ZXJyaWRlIHJlbW92ZSgpOiBDb21tYW5kIHtcblx0XHRyZXR1cm4gc3VwZXIucmVtb3ZlKCkgYXMgQ29tbWFuZDtcblx0fVxufVxuXG4vKipcbiAqIE9wdGlvbnMgdG8gdXNlIGZvciBjb21tYW5kIGV4ZWN1dGlvbiBiZWhhdmlvci5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDb21tYW5kT3B0aW9ucyBleHRlbmRzIEFrYWlyb01vZHVsZU9wdGlvbnMge1xuXHQvKipcblx0ICogQ29tbWFuZCBuYW1lcy5cblx0ICovXG5cdGFsaWFzZXM/OiBzdHJpbmdbXTtcblxuXHQvKipcblx0ICogQXJndW1lbnQgb3B0aW9ucyBvciBnZW5lcmF0b3IuXG5cdCAqL1xuXHRhcmdzPzogQXJndW1lbnRPcHRpb25zW10gfCBBcmd1bWVudEdlbmVyYXRvcjtcblxuXHQvKipcblx0ICogVGhlIGRlZmF1bHQgYXJndW1lbnQgb3B0aW9ucy5cblx0ICovXG5cdGFyZ3VtZW50RGVmYXVsdHM/OiBEZWZhdWx0QXJndW1lbnRPcHRpb25zO1xuXG5cdC8qKlxuXHQgKiBGdW5jdGlvbiB0byBydW4gYmVmb3JlIGFyZ3VtZW50IHBhcnNpbmcgYW5kIGV4ZWN1dGlvbi5cblx0ICovXG5cdGJlZm9yZT86IEJlZm9yZUFjdGlvbjtcblxuXHQvKipcblx0ICogUmVzdHJpY3RzIGNoYW5uZWwgdG8gZWl0aGVyICdndWlsZCcgb3IgJ2RtJy5cblx0ICovXG5cdGNoYW5uZWw/OiBcImd1aWxkXCIgfCBcImRtXCI7XG5cblx0LyoqXG5cdCAqIFBlcm1pc3Npb25zIHJlcXVpcmVkIGJ5IHRoZSBjbGllbnQgdG8gcnVuIHRoaXMgY29tbWFuZC5cblx0ICovXG5cdGNsaWVudFBlcm1pc3Npb25zPzogUGVybWlzc2lvblJlc29sdmFibGUgfCBQZXJtaXNzaW9uUmVzb2x2YWJsZVtdIHwgTWlzc2luZ1Blcm1pc3Npb25TdXBwbGllcjtcblxuXHQvKipcblx0ICogV2hldGhlciBvciBub3QgdG8gcnVuIG9uIG1lc3NhZ2VzIHRoYXQgYXJlIG5vdCBkaXJlY3RseSBjb21tYW5kcy5cblx0ICovXG5cdGNvbmRpdGlvbj86IEV4ZWN1dGlvblByZWRpY2F0ZTtcblxuXHQvKipcblx0ICogVGhlIGNvbW1hbmQgY29vbGRvd24gaW4gbWlsbGlzZWNvbmRzLlxuXHQgKi9cblx0Y29vbGRvd24/OiBudW1iZXI7XG5cblx0LyoqXG5cdCAqIERlc2NyaXB0aW9uIG9mIHRoZSBjb21tYW5kLlxuXHQgKi9cblx0ZGVzY3JpcHRpb24/OiBzdHJpbmcgfCBhbnkgfCBhbnlbXTtcblxuXHQvKipcblx0ICogV2hldGhlciBvciBub3QgbWVzc2FnZSBlZGl0cyB3aWxsIHJ1biB0aGlzIGNvbW1hbmQuXG5cdCAqL1xuXHRlZGl0YWJsZT86IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIEZsYWdzIHRvIHVzZSB3aGVuIHVzaW5nIGFuIEFyZ3VtZW50R2VuZXJhdG9yXG5cdCAqL1xuXHRmbGFncz86IHN0cmluZ1tdO1xuXG5cdC8qKlxuXHQgKiBJRCBvZiB1c2VyKHMpIHRvIGlnbm9yZSBjb29sZG93biBvciBhIGZ1bmN0aW9uIHRvIGlnbm9yZS5cblx0ICovXG5cdGlnbm9yZUNvb2xkb3duPzogU25vd2ZsYWtlIHwgU25vd2ZsYWtlW10gfCBJZ25vcmVDaGVja1ByZWRpY2F0ZTtcblxuXHQvKipcblx0ICogSUQgb2YgdXNlcihzKSB0byBpZ25vcmUgYHVzZXJQZXJtaXNzaW9uc2AgY2hlY2tzIG9yIGEgZnVuY3Rpb24gdG8gaWdub3JlLlxuXHQgKi9cblx0aWdub3JlUGVybWlzc2lvbnM/OiBTbm93Zmxha2UgfCBTbm93Zmxha2VbXSB8IElnbm9yZUNoZWNrUHJlZGljYXRlO1xuXG5cdC8qKlxuXHQgKiBUaGUga2V5IHR5cGUgb3Iga2V5IGdlbmVyYXRvciBmb3IgdGhlIGxvY2tlci4gSWYgbG9jayBpcyBhIHN0cmluZywgaXQncyBleHBlY3RlZCBvbmUgb2YgJ2d1aWxkJywgJ2NoYW5uZWwnLCBvciAndXNlcidcblx0ICovXG5cdGxvY2s/OiBLZXlTdXBwbGllciB8IFwiZ3VpbGRcIiB8IFwiY2hhbm5lbFwiIHwgXCJ1c2VyXCI7XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IHRvIG9ubHkgYWxsb3cgdGhlIGNvbW1hbmQgdG8gYmUgcnVuIGluIE5TRlcgY2hhbm5lbHMuXG5cdCAqL1xuXHRvbmx5TnNmdz86IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIE9wdGlvbiBmbGFncyB0byB1c2Ugd2hlbiB1c2luZyBhbiBBcmd1bWVudEdlbmVyYXRvci5cblx0ICovXG5cdG9wdGlvbkZsYWdzPzogc3RyaW5nW107XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IHRvIGFsbG93IGNsaWVudCBvd25lcihzKSBvbmx5LlxuXHQgKi9cblx0b3duZXJPbmx5PzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogVGhlIHByZWZpeChlcykgdG8gb3ZlcndyaXRlIHRoZSBnbG9iYWwgb25lIGZvciB0aGlzIGNvbW1hbmQuXG5cdCAqL1xuXHRwcmVmaXg/OiBzdHJpbmcgfCBzdHJpbmdbXSB8IFByZWZpeFN1cHBsaWVyO1xuXG5cdC8qKlxuXHQgKiBXaGV0aGVyIG9yIG5vdCB0byBjb25zaWRlciBxdW90ZXMuXG5cdCAqL1xuXHRxdW90ZWQ/OiBib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBBbW91bnQgb2YgY29tbWFuZCB1c2VzIGFsbG93ZWQgdW50aWwgY29vbGRvd24uXG5cdCAqL1xuXHRyYXRlbGltaXQ/OiBudW1iZXI7XG5cblx0LyoqXG5cdCAqIEEgcmVnZXggdG8gbWF0Y2ggaW4gbWVzc2FnZXMgdGhhdCBhcmUgbm90IGRpcmVjdGx5IGNvbW1hbmRzLiBUaGUgYXJncyBvYmplY3Qgd2lsbCBoYXZlIGBtYXRjaGAgYW5kIGBtYXRjaGVzYCBwcm9wZXJ0aWVzLlxuXHQgKi9cblx0cmVnZXg/OiBSZWdFeHAgfCBSZWdleFN1cHBsaWVyO1xuXG5cdC8qKlxuXHQgKiBDdXN0b20gc2VwYXJhdG9yIGZvciBhcmd1bWVudCBpbnB1dC5cblx0ICovXG5cdHNlcGFyYXRvcj86IHN0cmluZztcblxuXHQvKipcblx0ICogTWFyayBjb21tYW5kIGFzIHNsYXNoIGNvbW1hbmQgYW5kIHNldCBpbmZvcm1hdGlvbi5cblx0ICovXG5cdHNsYXNoPzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogV2hldGhlciBzbGFzaCBjb21tYW5kIHJlc3BvbnNlcyBmb3IgdGhpcyBjb21tYW5kIHNob3VsZCBiZSBlcGhlbWVyYWwgb3Igbm90LlxuXHQgKi9cblx0c2xhc2hFcGhlbWVyYWw/OiBib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBBc3NpZ24gc2xhc2ggY29tbWFuZHMgdG8gU3BlY2lmaWMgZ3VpbGRzLiBUaGlzIG9wdGlvbiB3aWxsIG1ha2UgdGhlIGNvbW1hbmRzIGRvIG5vdCByZWdpc3RlciBnbG9iYWxseSwgYnV0IG9ubHkgdG8gdGhlIGNob3NlbiBzZXJ2ZXJzLlxuXHQgKi9cblx0c2xhc2hHdWlsZHM/OiBzdHJpbmdbXTtcblxuXHQvKipcblx0ICogT3B0aW9ucyBmb3IgdXNpbmcgdGhlIHNsYXNoIGNvbW1hbmQuXG5cdCAqL1xuXHRzbGFzaE9wdGlvbnM/OiBBcHBsaWNhdGlvbkNvbW1hbmRPcHRpb25EYXRhW107XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IHRvIGFsbG93IGNsaWVudCBzdXBlclVzZXJzKHMpIG9ubHkuXG5cdCAqL1xuXHRzdXBlclVzZXJPbmx5PzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogV2hldGhlciBvciBub3QgdG8gdHlwZSBpbiBjaGFubmVsIGR1cmluZyBleGVjdXRpb24uXG5cdCAqL1xuXHR0eXBpbmc/OiBib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBQZXJtaXNzaW9ucyByZXF1aXJlZCBieSB0aGUgdXNlciB0byBydW4gdGhpcyBjb21tYW5kLlxuXHQgKi9cblx0dXNlclBlcm1pc3Npb25zPzogUGVybWlzc2lvblJlc29sdmFibGUgfCBQZXJtaXNzaW9uUmVzb2x2YWJsZVtdIHwgTWlzc2luZ1Blcm1pc3Npb25TdXBwbGllcjtcbn1cblxuLyoqXG4gKiBBIGZ1bmN0aW9uIHRvIHJ1biBiZWZvcmUgYXJndW1lbnQgcGFyc2luZyBhbmQgZXhlY3V0aW9uLlxuICogQHBhcmFtIG1lc3NhZ2UgLSBNZXNzYWdlIHRoYXQgdHJpZ2dlcmVkIHRoZSBjb21tYW5kLlxuICovXG5leHBvcnQgdHlwZSBCZWZvcmVBY3Rpb24gPSAobWVzc2FnZTogTWVzc2FnZSkgPT4gYW55O1xuXG4vKipcbiAqIEEgZnVuY3Rpb24gdXNlZCB0byBzdXBwbHkgdGhlIGtleSBmb3IgdGhlIGxvY2tlci5cbiAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSB0aGF0IHRyaWdnZXJlZCB0aGUgY29tbWFuZC5cbiAqIEBwYXJhbSBhcmdzIC0gRXZhbHVhdGVkIGFyZ3VtZW50cy5cbiAqL1xuZXhwb3J0IHR5cGUgS2V5U3VwcGxpZXIgPSAobWVzc2FnZTogTWVzc2FnZSB8IEFrYWlyb01lc3NhZ2UsIGFyZ3M6IGFueSkgPT4gc3RyaW5nO1xuXG4vKipcbiAqIEEgZnVuY3Rpb24gdXNlZCB0byBjaGVjayBpZiB0aGUgY29tbWFuZCBzaG91bGQgcnVuIGFyYml0cmFyaWx5LlxuICogQHBhcmFtIG1lc3NhZ2UgLSBNZXNzYWdlIHRvIGNoZWNrLlxuICovXG5leHBvcnQgdHlwZSBFeGVjdXRpb25QcmVkaWNhdGUgPSAobWVzc2FnZTogTWVzc2FnZSkgPT4gYm9vbGVhbjtcblxuLyoqXG4gKiBBIGZ1bmN0aW9uIHVzZWQgdG8gY2hlY2sgaWYgYSBtZXNzYWdlIGhhcyBwZXJtaXNzaW9ucyBmb3IgdGhlIGNvbW1hbmQuXG4gKiBBIG5vbi1udWxsIHJldHVybiB2YWx1ZSBzaWduaWZpZXMgdGhlIHJlYXNvbiBmb3IgbWlzc2luZyBwZXJtaXNzaW9ucy5cbiAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSB0aGF0IHRyaWdnZXJlZCB0aGUgY29tbWFuZC5cbiAqL1xuZXhwb3J0IHR5cGUgTWlzc2luZ1Blcm1pc3Npb25TdXBwbGllciA9IChtZXNzYWdlOiBNZXNzYWdlKSA9PiBQcm9taXNlPGFueT4gfCBhbnk7XG5cbi8qKlxuICogQSBmdW5jdGlvbiB1c2VkIHRvIHJldHVybiBhIHJlZ3VsYXIgZXhwcmVzc2lvbi5cbiAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSB0byBnZXQgcmVnZXggZm9yLlxuICovXG5leHBvcnQgdHlwZSBSZWdleFN1cHBsaWVyID0gKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IFJlZ0V4cDtcblxuLyoqXG4gKiBHZW5lcmF0b3IgZm9yIGFyZ3VtZW50cy5cbiAqIFdoZW4geWllbGRpbmcgYXJndW1lbnQgb3B0aW9ucywgdGhhdCBhcmd1bWVudCBpcyByYW4gYW5kIHRoZSByZXN1bHQgb2YgdGhlIHByb2Nlc3NpbmcgaXMgZ2l2ZW4uXG4gKiBUaGUgbGFzdCB2YWx1ZSB3aGVuIHRoZSBnZW5lcmF0b3IgaXMgZG9uZSBpcyB0aGUgcmVzdWx0aW5nIGBhcmdzYCBmb3IgdGhlIGNvbW1hbmQncyBgZXhlY2AuXG4gKiBAcGFyYW0gbWVzc2FnZSAtIE1lc3NhZ2UgdGhhdCB0cmlnZ2VyZWQgdGhlIGNvbW1hbmQuXG4gKiBAcGFyYW0gcGFyc2VkIC0gUGFyc2VkIGNvbnRlbnQuXG4gKiBAcGFyYW0gc3RhdGUgLSBBcmd1bWVudCBwcm9jZXNzaW5nIHN0YXRlLlxuICovXG5leHBvcnQgdHlwZSBBcmd1bWVudEdlbmVyYXRvciA9IChcblx0bWVzc2FnZTogTWVzc2FnZSxcblx0cGFyc2VkOiBDb250ZW50UGFyc2VyUmVzdWx0LFxuXHRzdGF0ZTogQXJndW1lbnRSdW5uZXJTdGF0ZVxuKSA9PiBJdGVyYWJsZUl0ZXJhdG9yPEFyZ3VtZW50T3B0aW9ucyB8IEZsYWc+O1xuIl19