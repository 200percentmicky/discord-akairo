"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const AkairoError_1 = __importDefault(require("../../util/AkairoError"));
const AkairoModule_1 = __importDefault(require("../AkairoModule"));
const Argument_1 = __importDefault(require("./arguments/Argument"));
const ArgumentRunner_1 = __importDefault(require("./arguments/ArgumentRunner"));
const ContentParser_1 = __importDefault(require("./ContentParser"));
/**
 * Represents a command.
 * @param id - Command ID.
 * @param options - Options for the command.
 */
class Command extends AkairoModule_1.default {
    /**
     * Executes the command.
     * @param message - Message that triggered the command.
     * @param args - Evaluated arguments.
     */
    constructor(id, options) {
        super(id, { category: options?.category });
        const { onlyNsfw = false, aliases = [], args = this._args || this.args || [], quoted = true, separator, channel = null, ownerOnly = false, superUserOnly = false, editable = true, typing = false, cooldown = null, ratelimit = 1, argumentDefaults = {}, description = "", prefix = this.prefix, clientPermissions = this.clientPermissions, userPermissions = this.userPermissions, regex = this.regex, condition = this.condition || (() => false), before = this.before || (() => undefined), lock, ignoreCooldown, ignorePermissions, flags = [], optionFlags = [], slash = false, slashOptions, slashEphemeral = false, slashGuilds = [], slashOnly = false } = options ?? {};
        this.aliases = aliases ?? [];
        const { flagWords, optionFlagWords } = Array.isArray(args)
            ? ContentParser_1.default.getFlags(args)
            : { flagWords: flags, optionFlagWords: optionFlags };
        this.contentParser = new ContentParser_1.default({
            flagWords,
            optionFlagWords,
            quoted,
            separator
        });
        this.argumentRunner = new ArgumentRunner_1.default(this);
        this.argumentGenerator = (Array.isArray(args)
            ? ArgumentRunner_1.default.fromArguments(args.map(arg => [arg.id, new Argument_1.default(this, arg)]))
            : args.bind(this));
        this.onlyNsfw = Boolean(onlyNsfw);
        this.channel = channel;
        this.ownerOnly = Boolean(ownerOnly);
        this.superUserOnly = Boolean(superUserOnly);
        this.editable = Boolean(editable);
        this.typing = Boolean(typing);
        this.cooldown = cooldown;
        this.ratelimit = ratelimit;
        this.argumentDefaults = argumentDefaults;
        this.description = Array.isArray(description) ? description.join("\n") : description;
        this.prefix = typeof prefix === "function" ? prefix.bind(this) : prefix;
        this.clientPermissions = typeof clientPermissions === "function" ? clientPermissions.bind(this) : clientPermissions;
        this.userPermissions = typeof userPermissions === "function" ? userPermissions.bind(this) : userPermissions;
        this.regex = typeof regex === "function" ? regex.bind(this) : regex;
        this.condition = condition.bind(this);
        this.before = before.bind(this);
        this.lock = lock;
        if (typeof lock === "string") {
            this.lock = {
                guild: (message) => message.guild && message.guild.id,
                channel: (message) => message.channel.id,
                user: (message) => message.author.id
            }[lock];
        }
        if (this.lock)
            this.locker = new Set();
        this.ignoreCooldown = typeof ignoreCooldown === "function" ? ignoreCooldown.bind(this) : ignoreCooldown;
        this.ignorePermissions = typeof ignorePermissions === "function" ? ignorePermissions.bind(this) : ignorePermissions;
        this.slashOptions = slashOptions;
        this.slashEphemeral = slashEphemeral;
        this.slash = slash;
        this.slashGuilds = slashGuilds;
        this.slashOnly = slashOnly;
    }
    /**
     * Command names.
     */
    aliases;
    /**
     * Default prompt options.
     */
    argumentDefaults;
    /**
     * Usable only in this channel type.
     */
    channel;
    /**
     * Permissions required to run command by the client.
     */
    clientPermissions;
    /**
     * Cooldown in milliseconds.
     */
    cooldown;
    /**
     * Description of the command.
     */
    description;
    /**
     * Whether or not this command can be ran by an edit.
     */
    editable;
    /**
     * ID of user(s) to ignore cooldown or a function to ignore.
     */
    ignoreCooldown;
    /**
     * ID of user(s) to ignore `userPermissions` checks or a function to ignore.
     */
    ignorePermissions;
    /**
     * The key supplier for the locker.
     */
    lock;
    /**
     * Stores the current locks.
     */
    locker;
    /**
     * Whether or not the command can only be run in  NSFW channels.
     */
    onlyNsfw;
    /**
     * Usable only by the client owner.
     */
    ownerOnly;
    /**
     * Command prefix overwrite.
     */
    prefix;
    /**
     * Whether or not to consider quotes.
     */
    quoted;
    /**
     * Uses allowed before cooldown.
     */
    ratelimit;
    /**
     * The regex trigger for this command.
     */
    regex;
    /**
     * Mark command as slash command and set information.
     */
    slash;
    /**
     * Whether slash command responses for this command should be ephemeral or not.
     */
    slashEphemeral;
    /**
     * Assign slash commands to Specific guilds. This option will make the commands not register globally, but only in the chosen servers.
     */
    slashGuilds;
    /**
     * Options for using the slash command.
     */
    slashOptions;
    /**
     * Whether or not to allow client superUsers(s) only.
     */
    superUserOnly;
    /**
     * Whether or not to type during command execution.
     */
    typing;
    /**
     * Permissions required to run command by the user.
     */
    userPermissions;
    /**
     * Argument options or generator.
     */
    _args;
    /**
     * The content parser.
     */
    contentParser;
    /**
     * The argument runner.
     */
    argumentRunner;
    /**
     * Only allows this command to be executed as a slash command.
     */
    slashOnly;
    /**
     * Generator for arguments.
     * When yielding argument options, that argument is ran and the result of the processing is given.
     * The last value when the generator is done is the resulting `args` for the command's `exec`.
     * @param message - Message that triggered the command.
     * @param parsed - Parsed content.
     * @param state - Argument processing state.
     */
    *args(message, parsed, state) { }
    /**
     * Generator for arguments.
     */
    argumentGenerator;
    /**
     * Runs before argument parsing and execution.
     * @param message - Message being handled.
     */
    before(message) { }
    /**
     * Checks if the command should be ran by using an arbitrary condition.
     * @param message - Message being handled.
     */
    condition(message) {
        return false;
    }
    exec(message, args) {
        throw new AkairoError_1.default("NOT_IMPLEMENTED", this.constructor.name, "exec");
    }
    /**
     * Execute the slash command
     * @param message - Message for slash command
     * @param args - Slash command options
     */
    execSlash(message, ...args) {
        if (this.slash) {
            throw new AkairoError_1.default("NOT_IMPLEMENTED", this.constructor.name, "execSlash");
        }
    }
    /**
     * Parses content using the command's arguments.
     * @param message - Message to use.
     * @param content - String to parse.
     */
    parse(message, content) {
        const parsed = this.contentParser.parse(content);
        return this.argumentRunner.run(message, parsed, this.argumentGenerator);
    }
    /**
     * Reloads the command.
     */
    reload() {
        return super.reload();
    }
    /**
     * Removes the command.
     */
    remove() {
        return super.remove();
    }
}
exports.default = Command;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tbWFuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9zdHJ1Y3QvY29tbWFuZHMvQ29tbWFuZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLHlFQUFpRDtBQUlqRCxtRUFBb0U7QUFDcEUsb0VBQXlGO0FBQ3pGLGdGQUFpRjtBQUVqRixvRUFBcUU7QUFHckU7Ozs7R0FJRztBQUNILE1BQThCLE9BQVEsU0FBUSxzQkFBWTtJQUN6RDs7OztPQUlHO0lBQ0gsWUFBWSxFQUFVLEVBQUUsT0FBd0I7UUFDL0MsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUUzQyxNQUFNLEVBQ0wsUUFBUSxHQUFHLEtBQUssRUFDaEIsT0FBTyxHQUFHLEVBQUUsRUFDWixJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLEVBQUUsRUFDcEMsTUFBTSxHQUFHLElBQUksRUFDYixTQUFTLEVBQ1QsT0FBTyxHQUFHLElBQUssRUFDZixTQUFTLEdBQUcsS0FBSyxFQUNqQixhQUFhLEdBQUcsS0FBSyxFQUNyQixRQUFRLEdBQUcsSUFBSSxFQUNmLE1BQU0sR0FBRyxLQUFLLEVBQ2QsUUFBUSxHQUFHLElBQUssRUFDaEIsU0FBUyxHQUFHLENBQUMsRUFDYixnQkFBZ0IsR0FBRyxFQUFFLEVBQ3JCLFdBQVcsR0FBRyxFQUFFLEVBQ2hCLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxFQUNwQixpQkFBaUIsR0FBRyxJQUFJLENBQUMsaUJBQWlCLEVBQzFDLGVBQWUsR0FBRyxJQUFJLENBQUMsZUFBZSxFQUN0QyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFDbEIsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFDM0MsTUFBTSxHQUFHLElBQUksQ0FBQyxN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QztJQUNsQyxDQUFDO0NBQ0Q7QUF6VUQsMEJBeVVDIiwic291cmNlc0NvbnRlbnQiOlsiLyogIGVzbGludC1kaXNhYmxlIGZ1bmMtbmFtZXMsIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFycyAqL1xuaW1wb3J0IHsgQXBwbGljYXRpb25Db21tYW5kT3B0aW9uRGF0YSwgTWVzc2FnZSwgUGVybWlzc2lvblJlc29sdmFibGUsIFNub3dmbGFrZSB9IGZyb20gXCJkaXNjb3JkLmpzXCI7XG5pbXBvcnQgQWthaXJvRXJyb3IgZnJvbSBcIi4uLy4uL3V0aWwvQWthaXJvRXJyb3JcIjtcbmltcG9ydCBBa2Fpcm9NZXNzYWdlIGZyb20gXCIuLi8uLi91dGlsL0FrYWlyb01lc3NhZ2VcIjtcbmltcG9ydCBDYXRlZ29yeSBmcm9tIFwiLi4vLi4vdXRpbC9DYXRlZ29yeVwiO1xuaW1wb3J0IEFrYWlyb0NsaWVudCBmcm9tIFwiLi4vQWthaXJvQ2xpZW50XCI7XG5pbXBvcnQgQWthaXJvTW9kdWxlLCB7IEFrYWlyb01vZHVsZU9wdGlvbnMgfSBmcm9tIFwiLi4vQWthaXJvTW9kdWxlXCI7XG5pbXBvcnQgQXJndW1lbnQsIHsgQXJndW1lbnRPcHRpb25zLCBEZWZhdWx0QXJndW1lbnRPcHRpb25zIH0gZnJvbSBcIi4vYXJndW1lbnRzL0FyZ3VtZW50XCI7XG5pbXBvcnQgQXJndW1lbnRSdW5uZXIsIHsgQXJndW1lbnRSdW5uZXJTdGF0ZSB9IGZyb20gXCIuL2FyZ3VtZW50cy9Bcmd1bWVudFJ1bm5lclwiO1xuaW1wb3J0IENvbW1hbmRIYW5kbGVyLCB7IElnbm9yZUNoZWNrUHJlZGljYXRlLCBQcmVmaXhTdXBwbGllciB9IGZyb20gXCIuL0NvbW1hbmRIYW5kbGVyXCI7XG5pbXBvcnQgQ29udGVudFBhcnNlciwgeyBDb250ZW50UGFyc2VyUmVzdWx0IH0gZnJvbSBcIi4vQ29udGVudFBhcnNlclwiO1xuaW1wb3J0IEZsYWcgZnJvbSBcIi4vRmxhZ1wiO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgYSBjb21tYW5kLlxuICogQHBhcmFtIGlkIC0gQ29tbWFuZCBJRC5cbiAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9ucyBmb3IgdGhlIGNvbW1hbmQuXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGFic3RyYWN0IGNsYXNzIENvbW1hbmQgZXh0ZW5kcyBBa2Fpcm9Nb2R1bGUge1xuXHQvKipcblx0ICogRXhlY3V0ZXMgdGhlIGNvbW1hbmQuXG5cdCAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSB0aGF0IHRyaWdnZXJlZCB0aGUgY29tbWFuZC5cblx0ICogQHBhcmFtIGFyZ3MgLSBFdmFsdWF0ZWQgYXJndW1lbnRzLlxuXHQgKi9cblx0Y29uc3RydWN0b3IoaWQ6IHN0cmluZywgb3B0aW9ucz86IENvbW1hbmRPcHRpb25zKSB7XG5cdFx0c3VwZXIoaWQsIHsgY2F0ZWdvcnk6IG9wdGlvbnM/LmNhdGVnb3J5IH0pO1xuXG5cdFx0Y29uc3Qge1xuXHRcdFx0b25seU5zZncgPSBmYWxzZSxcblx0XHRcdGFsaWFzZXMgPSBbXSxcblx0XHRcdGFyZ3MgPSB0aGlzLl9hcmdzIHx8IHRoaXMuYXJncyB8fCBbXSxcblx0XHRcdHF1b3RlZCA9IHRydWUsXG5cdFx0XHRzZXBhcmF0b3IsXG5cdFx0XHRjaGFubmVsID0gbnVsbCEsXG5cdFx0XHRvd25lck9ubHkgPSBmYWxzZSxcblx0XHRcdHN1cGVyVXNlck9ubHkgPSBmYWxzZSxcblx0XHRcdGVkaXRhYmxlID0gdHJ1ZSxcblx0XHRcdHR5cGluZyA9IGZhbHNlLFxuXHRcdFx0Y29vbGRvd24gPSBudWxsISxcblx0XHRcdHJhdGVsaW1pdCA9IDEsXG5cdFx0XHRhcmd1bWVudERlZmF1bHRzID0ge30sXG5cdFx0XHRkZXNjcmlwdGlvbiA9IFwiXCIsXG5cdFx0XHRwcmVmaXggPSB0aGlzLnByZWZpeCxcblx0XHRcdGNsaWVudFBlcm1pc3Npb25zID0gdGhpcy5jbGllbnRQZXJtaXNzaW9ucyxcblx0XHRcdHVzZXJQZXJtaXNzaW9ucyA9IHRoaXMudXNlclBlcm1pc3Npb25zLFxuXHRcdFx0cmVnZXggPSB0aGlzLnJlZ2V4LFxuXHRcdFx0Y29uZGl0aW9uID0gdGhpcy5jb25kaXRpb24gfHwgKCgpID0+IGZhbHNlKSxcblx0XHRcdGJlZm9yZSA9IHRoaXMuYmVmb3JlIHx8ICgoKSA9PiB1bmRlZmluZWQpLFxuXHRcdFx0bG9jayxcblx0XHRcdGlnbm9yZUNvb2xkb3duLFxuXHRcdFx0aWdub3JlUGVybWlzc2lvbnMsXG5cdFx0XHRmbGFncyA9IFtdLFxuXHRcdFx0b3B0aW9uRmxhZ3MgPSBbXSxcblx0XHRcdHNsYXNoID0gZmFsc2UsXG5cdFx0XHRzbGFzaE9wdGlvbnMsXG5cdFx0XHRzbGFzaEVwaGVtZXJhbCA9IGZhbHNlLFxuXHRcdFx0c2xhc2hHdWlsZHMgPSBbXSxcblx0XHRcdHNsYXNoT25seSA9IGZhbHNlXG5cdFx0fTogQ29tbWFuZE9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuXHRcdHRoaXMuYWxpYXNlcyA9IGFsaWFzZXMgPz8gW107XG5cdFx0Y29uc3QgeyBmbGFnV29yZHMsIG9wdGlvbkZsYWdXb3JkcyB9ID0gQXJyYXkuaXNBcnJheShhcmdzKVxuXHRcdFx0PyBDb250ZW50UGFyc2VyLmdldEZsYWdzKGFyZ3MpXG5cdFx0XHQ6IHsgZmxhZ1dvcmRzOiBmbGFncywgb3B0aW9uRmxhZ1dvcmRzOiBvcHRpb25GbGFncyB9O1xuXHRcdHRoaXMuY29udGVudFBhcnNlciA9IG5ldyBDb250ZW50UGFyc2VyKHtcblx0XHRcdGZsYWdXb3Jkcyxcblx0XHRcdG9wdGlvbkZsYWdXb3Jkcyxcblx0XHRcdHF1b3RlZCxcblx0XHRcdHNlcGFyYXRvclxuXHRcdH0pO1xuXHRcdHRoaXMuYXJndW1lbnRSdW5uZXIgPSBuZXcgQXJndW1lbnRSdW5uZXIodGhpcyk7XG5cdFx0dGhpcy5hcmd1bWVudEdlbmVyYXRvciA9IChcblx0XHRcdEFycmF5LmlzQXJyYXkoYXJncylcblx0XHRcdFx0PyBBcmd1bWVudFJ1bm5lci5mcm9tQXJndW1lbnRzKGFyZ3MubWFwKGFyZyA9PiBbYXJnLmlkISwgbmV3IEFyZ3VtZW50KHRoaXMsIGFyZyldKSlcblx0XHRcdFx0OiBhcmdzLmJpbmQodGhpcylcblx0XHQpIGFzIEFyZ3VtZW50R2VuZXJhdG9yO1xuXHRcdHRoaXMub25seU5zZncgPSBCb29sZWFuKG9ubHlOc2Z3KTtcblx0XHR0aGlzLmNoYW5uZWwgPSBjaGFubmVsITtcblx0XHR0aGlzLm93bmVyT25seSA9IEJvb2xlYW4ob3duZXJPbmx5KTtcblx0XHR0aGlzLnN1cGVyVXNlck9ubHkgPSBCb29sZWFuKHN1cGVyVXNlck9ubHkpO1xuXHRcdHRoaXMuZWRpdGFibGUgPSBCb29sZWFuKGVkaXRhYmxlKTtcblx0XHR0aGlzLnR5cGluZyA9IEJvb2xlYW4odHlwaW5nKTtcblx0XHR0aGlzLmNvb2xkb3duID0gY29vbGRvd24hO1xuXHRcdHRoaXMucmF0ZWxpbWl0ID0gcmF0ZWxpbWl0O1xuXHRcdHRoaXMuYXJndW1lbnREZWZhdWx0cyA9IGFyZ3VtZW50RGVmYXVsdHM7XG5cdFx0dGhpcy5kZXNjcmlwdGlvbiA9IEFycmF5LmlzQXJyYXkoZGVzY3JpcHRpb24pID8gZGVzY3JpcHRpb24uam9pbihcIlxcblwiKSA6IGRlc2NyaXB0aW9uO1xuXHRcdHRoaXMucHJlZml4ID0gdHlwZW9mIHByZWZpeCA9PT0gXCJmdW5jdGlvblwiID8gcHJlZml4LmJpbmQodGhpcykgOiBwcmVmaXg7XG5cdFx0dGhpcy5jbGllbnRQZXJtaXNzaW9ucyA9IHR5cGVvZiBjbGllbnRQZXJtaXNzaW9ucyA9PT0gXCJmdW5jdGlvblwiID8gY2xpZW50UGVybWlzc2lvbnMuYmluZCh0aGlzKSA6IGNsaWVudFBlcm1pc3Npb25zO1xuXHRcdHRoaXMudXNlclBlcm1pc3Npb25zID0gdHlwZW9mIHVzZXJQZXJtaXNzaW9ucyA9PT0gXCJmdW5jdGlvblwiID8gdXNlclBlcm1pc3Npb25zLmJpbmQodGhpcykgOiB1c2VyUGVybWlzc2lvbnM7XG5cdFx0dGhpcy5yZWdleCA9IHR5cGVvZiByZWdleCA9PT0gXCJmdW5jdGlvblwiID8gcmVnZXguYmluZCh0aGlzKSA6IHJlZ2V4O1xuXHRcdHRoaXMuY29uZGl0aW9uID0gY29uZGl0aW9uLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5iZWZvcmUgPSBiZWZvcmUuYmluZCh0aGlzKTtcblx0XHR0aGlzLmxvY2sgPSBsb2NrO1xuXHRcdGlmICh0eXBlb2YgbG9jayA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0dGhpcy5sb2NrID0ge1xuXHRcdFx0XHRndWlsZDogKG1lc3NhZ2U6IE1lc3NhZ2UgfCBBa2Fpcm9NZXNzYWdlKTogc3RyaW5nID0+IG1lc3NhZ2UuZ3VpbGQhICYmIG1lc3NhZ2UuZ3VpbGQuaWQhLFxuXHRcdFx0XHRjaGFubmVsOiAobWVzc2FnZTogTWVzc2FnZSB8IEFrYWlyb01lc3NhZ2UpOiBzdHJpbmcgPT4gbWVzc2FnZS5jaGFubmVsIS5pZCxcblx0XHRcdFx0dXNlcjogKG1lc3NhZ2U6IE1lc3NhZ2UgfCBBa2Fpcm9NZXNzYWdlKTogc3RyaW5nID0+IG1lc3NhZ2UuYXV0aG9yLmlkXG5cdFx0XHR9W2xvY2tdO1xuXHRcdH1cblx0XHRpZiAodGhpcy5sb2NrKSB0aGlzLmxvY2tlciA9IG5ldyBTZXQoKTtcblx0XHR0aGlzLmlnbm9yZUNvb2xkb3duID0gdHlwZW9mIGlnbm9yZUNvb2xkb3duID09PSBcImZ1bmN0aW9uXCIgPyBpZ25vcmVDb29sZG93bi5iaW5kKHRoaXMpIDogaWdub3JlQ29vbGRvd247XG5cdFx0dGhpcy5pZ25vcmVQZXJtaXNzaW9ucyA9IHR5cGVvZiBpZ25vcmVQZXJtaXNzaW9ucyA9PT0gXCJmdW5jdGlvblwiID8gaWdub3JlUGVybWlzc2lvbnMuYmluZCh0aGlzKSA6IGlnbm9yZVBlcm1pc3Npb25zO1xuXHRcdHRoaXMuc2xhc2hPcHRpb25zID0gc2xhc2hPcHRpb25zO1xuXHRcdHRoaXMuc2xhc2hFcGhlbWVyYWwgPSBzbGFzaEVwaGVtZXJhbDtcblx0XHR0aGlzLnNsYXNoID0gc2xhc2g7XG5cdFx0dGhpcy5zbGFzaEd1aWxkcyA9IHNsYXNoR3VpbGRzO1xuXHRcdHRoaXMuc2xhc2hPbmx5ID0gc2xhc2hPbmx5O1xuXHR9XG5cblx0LyoqXG5cdCAqIENvbW1hbmQgbmFtZXMuXG5cdCAqL1xuXHRwdWJsaWMgYWxpYXNlczogc3RyaW5nW107XG5cblx0LyoqXG5cdCAqIERlZmF1bHQgcHJvbXB0IG9wdGlvbnMuXG5cdCAqL1xuXHRwdWJsaWMgYXJndW1lbnREZWZhdWx0czogRGVmYXVsdEFyZ3VtZW50T3B0aW9ucztcblxuXHQvKipcblx0ICogQ2F0ZWdvcnkgdGhlIGNvbW1hbmQgYmVsb25ncyB0by5cblx0ICovXG5cdHB1YmxpYyBkZWNsYXJlIGNhdGVnb3J5OiBDYXRlZ29yeTxzdHJpbmcsIENvbW1hbmQ+O1xuXG5cdC8qKlxuXHQgKiBVc2FibGUgb25seSBpbiB0aGlzIGNoYW5uZWwgdHlwZS5cblx0ICovXG5cdHB1YmxpYyBjaGFubmVsPzogc3RyaW5nO1xuXG5cdC8qKlxuXHQgKiBUaGUgQWthaXJvIGNsaWVudC5cblx0ICovXG5cdHB1YmxpYyBkZWNsYXJlIGNsaWVudDogQWthaXJvQ2xpZW50O1xuXG5cdC8qKlxuXHQgKiBQZXJtaXNzaW9ucyByZXF1aXJlZCB0byBydW4gY29tbWFuZCBieSB0aGUgY2xpZW50LlxuXHQgKi9cblx0cHVibGljIGNsaWVudFBlcm1pc3Npb25zPzogUGVybWlzc2lvblJlc29sdmFibGUgfCBQZXJtaXNzaW9uUmVzb2x2YWJsZVtdIHwgTWlzc2luZ1Blcm1pc3Npb25TdXBwbGllcjtcblxuXHQvKipcblx0ICogQ29vbGRvd24gaW4gbWlsbGlzZWNvbmRzLlxuXHQgKi9cblx0cHVibGljIGNvb2xkb3duPzogbnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBEZXNjcmlwdGlvbiBvZiB0aGUgY29tbWFuZC5cblx0ICovXG5cdHB1YmxpYyBkZXNjcmlwdGlvbjogYW55O1xuXG5cdC8qKlxuXHQgKiBXaGV0aGVyIG9yIG5vdCB0aGlzIGNvbW1hbmQgY2FuIGJlIHJhbiBieSBhbiBlZGl0LlxuXHQgKi9cblx0cHVibGljIGVkaXRhYmxlOiBib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBUaGUgZmlsZXBhdGguXG5cdCAqL1xuXHRwdWJsaWMgZGVjbGFyZSBmaWxlcGF0aDogc3RyaW5nO1xuXG5cdC8qKlxuXHQgKiBUaGUgaGFuZGxlci5cblx0ICovXG5cdHB1YmxpYyBkZWNsYXJlIGhhbmRsZXI6IENvbW1hbmRIYW5kbGVyO1xuXG5cdC8qKlxuXHQgKiBUaGUgSUQgb2YgdGhlIGNvbW1hbmQuXG5cdCAqL1xuXHRwdWJsaWMgZGVjbGFyZSBpZDogc3RyaW5nO1xuXG5cdC8qKlxuXHQgKiBJRCBvZiB1c2VyKHMpIHRvIGlnbm9yZSBjb29sZG93biBvciBhIGZ1bmN0aW9uIHRvIGlnbm9yZS5cblx0ICovXG5cdHB1YmxpYyBpZ25vcmVDb29sZG93bj86IFNub3dmbGFrZSB8IFNub3dmbGFrZVtdIHwgSWdub3JlQ2hlY2tQcmVkaWNhdGU7XG5cblx0LyoqXG5cdCAqIElEIG9mIHVzZXIocykgdG8gaWdub3JlIGB1c2VyUGVybWlzc2lvbnNgIGNoZWNrcyBvciBhIGZ1bmN0aW9uIHRvIGlnbm9yZS5cblx0ICovXG5cdHB1YmxpYyBpZ25vcmVQZXJtaXNzaW9ucz86IFNub3dmbGFrZSB8IFNub3dmbGFrZVtdIHwgSWdub3JlQ2hlY2tQcmVkaWNhdGU7XG5cblx0LyoqXG5cdCAqIFRoZSBrZXkgc3VwcGxpZXIgZm9yIHRoZSBsb2NrZXIuXG5cdCAqL1xuXHRwdWJsaWMgbG9jaz86IEtleVN1cHBsaWVyIHwgXCJjaGFubmVsXCIgfCBcImd1aWxkXCIgfCBcInVzZXJcIjtcblxuXHQvKipcblx0ICogU3RvcmVzIHRoZSBjdXJyZW50IGxvY2tzLlxuXHQgKi9cblx0cHVibGljIGxvY2tlcj86IFNldDxzdHJpbmc+O1xuXG5cdC8qKlxuXHQgKiBXaGV0aGVyIG9yIG5vdCB0aGUgY29tbWFuZCBjYW4gb25seSBiZSBydW4gaW4gIE5TRlcgY2hhbm5lbHMuXG5cdCAqL1xuXHRwdWJsaWMgb25seU5zZnc6IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIFVzYWJsZSBvbmx5IGJ5IHRoZSBjbGllbnQgb3duZXIuXG5cdCAqL1xuXHRwdWJsaWMgb3duZXJPbmx5OiBib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBDb21tYW5kIHByZWZpeCBvdmVyd3JpdGUuXG5cdCAqL1xuXHRwdWJsaWMgcHJlZml4Pzogc3RyaW5nIHwgc3RyaW5nW10gfCBQcmVmaXhTdXBwbGllcjtcblxuXHQvKipcblx0ICogV2hldGhlciBvciBub3QgdG8gY29uc2lkZXIgcXVvdGVzLlxuXHQgKi9cblx0cHVibGljIHF1b3RlZCE6IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIFVzZXMgYWxsb3dlZCBiZWZvcmUgY29vbGRvd24uXG5cdCAqL1xuXHRwdWJsaWMgcmF0ZWxpbWl0OiBudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSByZWdleCB0cmlnZ2VyIGZvciB0aGlzIGNvbW1hbmQuXG5cdCAqL1xuXHRwdWJsaWMgcmVnZXg/OiBSZWdFeHAgfCBSZWdleFN1cHBsaWVyO1xuXG5cdC8qKlxuXHQgKiBNYXJrIGNvbW1hbmQgYXMgc2xhc2ggY29tbWFuZCBhbmQgc2V0IGluZm9ybWF0aW9uLlxuXHQgKi9cblx0cHVibGljIHNsYXNoPzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogV2hldGhlciBzbGFzaCBjb21tYW5kIHJlc3BvbnNlcyBmb3IgdGhpcyBjb21tYW5kIHNob3VsZCBiZSBlcGhlbWVyYWwgb3Igbm90LlxuXHQgKi9cblx0cHVibGljIHNsYXNoRXBoZW1lcmFsPzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogQXNzaWduIHNsYXNoIGNvbW1hbmRzIHRvIFNwZWNpZmljIGd1aWxkcy4gVGhpcyBvcHRpb24gd2lsbCBtYWtlIHRoZSBjb21tYW5kcyBub3QgcmVnaXN0ZXIgZ2xvYmFsbHksIGJ1dCBvbmx5IGluIHRoZSBjaG9zZW4gc2VydmVycy5cblx0ICovXG5cdHB1YmxpYyBzbGFzaEd1aWxkcz86IFNub3dmbGFrZVtdO1xuXG5cdC8qKlxuXHQgKiBPcHRpb25zIGZvciB1c2luZyB0aGUgc2xhc2ggY29tbWFuZC5cblx0ICovXG5cdHB1YmxpYyBzbGFzaE9wdGlvbnM/OiBBcHBsaWNhdGlvbkNvbW1hbmRPcHRpb25EYXRhW107XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IHRvIGFsbG93IGNsaWVudCBzdXBlclVzZXJzKHMpIG9ubHkuXG5cdCAqL1xuXHRwdWJsaWMgc3VwZXJVc2VyT25seTogYm9vbGVhbjtcblxuXHQvKipcblx0ICogV2hldGhlciBvciBub3QgdG8gdHlwZSBkdXJpbmcgY29tbWFuZCBleGVjdXRpb24uXG5cdCAqL1xuXHRwdWJsaWMgdHlwaW5nOiBib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBQZXJtaXNzaW9ucyByZXF1aXJlZCB0byBydW4gY29tbWFuZCBieSB0aGUgdXNlci5cblx0ICovXG5cdHB1YmxpYyB1c2VyUGVybWlzc2lvbnM/OiBQZXJtaXNzaW9uUmVzb2x2YWJsZSB8IFBlcm1pc3Npb25SZXNvbHZhYmxlW10gfCBNaXNzaW5nUGVybWlzc2lvblN1cHBsaWVyO1xuXG5cdC8qKlxuXHQgKiBBcmd1bWVudCBvcHRpb25zIG9yIGdlbmVyYXRvci5cblx0ICovXG5cdHB1YmxpYyBfYXJncz86IEFyZ3VtZW50T3B0aW9uc1tdIHwgQXJndW1lbnRHZW5lcmF0b3I7XG5cblx0LyoqXG5cdCAqIFRoZSBjb250ZW50IHBhcnNlci5cblx0ICovXG5cdHB1YmxpYyBjb250ZW50UGFyc2VyOiBDb250ZW50UGFyc2VyO1xuXG5cdC8qKlxuXHQgKiBUaGUgYXJndW1lbnQgcnVubmVyLlxuXHQgKi9cblx0cHVibGljIGFyZ3VtZW50UnVubmVyOiBBcmd1bWVudFJ1bm5lcjtcblxuXHQvKipcblx0ICogT25seSBhbGxvd3MgdGhpcyBjb21tYW5kIHRvIGJlIGV4ZWN1dGVkIGFzIGEgc2xhc2ggY29tbWFuZC5cblx0ICovXG5cdHB1YmxpYyBzbGFzaE9ubHk6IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIEdlbmVyYXRvciBmb3IgYXJndW1lbnRzLlxuXHQgKiBXaGVuIHlpZWxkaW5nIGFyZ3VtZW50IG9wdGlvbnMsIHRoYXQgYXJndW1lbnQgaXMgcmFuIGFuZCB0aGUgcmVzdWx0IG9mIHRoZSBwcm9jZXNzaW5nIGlzIGdpdmVuLlxuXHQgKiBUaGUgbGFzdCB2YWx1ZSB3aGVuIHRoZSBnZW5lcmF0b3IgaXMgZG9uZSBpcyB0aGUgcmVzdWx0aW5nIGBhcmdzYCBmb3IgdGhlIGNvbW1hbmQncyBgZXhlY2AuXG5cdCAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSB0aGF0IHRyaWdnZXJlZCB0aGUgY29tbWFuZC5cblx0ICogQHBhcmFtIHBhcnNlZCAtIFBhcnNlZCBjb250ZW50LlxuXHQgKiBAcGFyYW0gc3RhdGUgLSBBcmd1bWVudCBwcm9jZXNzaW5nIHN0YXRlLlxuXHQgKi9cblx0cHVibGljICphcmdzKFxuXHRcdG1lc3NhZ2U6IE1lc3NhZ2UsXG5cdFx0cGFyc2VkOiBDb250ZW50UGFyc2VyUmVzdWx0LFxuXHRcdHN0YXRlOiBBcmd1bWVudFJ1bm5lclN0YXRlXG5cdCk6IEl0ZXJhYmxlSXRlcmF0b3I8QXJndW1lbnRPcHRpb25zIHwgRmxhZz4ge31cblxuXHQvKipcblx0ICogR2VuZXJhdG9yIGZvciBhcmd1bWVudHMuXG5cdCAqL1xuXHRwdWJsaWMgYXJndW1lbnRHZW5lcmF0b3I6IEFyZ3VtZW50R2VuZXJhdG9yO1xuXG5cdC8qKlxuXHQgKiBSdW5zIGJlZm9yZSBhcmd1bWVudCBwYXJzaW5nIGFuZCBleGVjdXRpb24uXG5cdCAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSBiZWluZyBoYW5kbGVkLlxuXHQgKi9cblx0cHVibGljIGJlZm9yZShtZXNzYWdlOiBNZXNzYWdlKTogYW55IHt9XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgY29tbWFuZCBzaG91bGQgYmUgcmFuIGJ5IHVzaW5nIGFuIGFyYml0cmFyeSBjb25kaXRpb24uXG5cdCAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSBiZWluZyBoYW5kbGVkLlxuXHQgKi9cblx0cHVibGljIGNvbmRpdGlvbihtZXNzYWdlOiBNZXNzYWdlKTogYm9vbGVhbiB8IFByb21pc2U8Ym9vbGVhbj4ge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHB1YmxpYyBleGVjKG1lc3NhZ2U6IE1lc3NhZ2UsIGFyZ3M6IGFueSk6IGFueTtcblx0cHVibGljIGV4ZWMobWVzc2FnZTogTWVzc2FnZSB8IEFrYWlyb01lc3NhZ2UsIGFyZ3M6IGFueSk6IGFueTtcblx0cHVibGljIGV4ZWMobWVzc2FnZTogTWVzc2FnZSB8IEFrYWlyb01lc3NhZ2UsIGFyZ3M6IGFueSk6IGFueSB7XG5cdFx0dGhyb3cgbmV3IEFrYWlyb0Vycm9yKFwiTk9UX0lNUExFTUVOVEVEXCIsIHRoaXMuY29uc3RydWN0b3IubmFtZSwgXCJleGVjXCIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEV4ZWN1dGUgdGhlIHNsYXNoIGNvbW1hbmRcblx0ICogQHBhcmFtIG1lc3NhZ2UgLSBNZXNzYWdlIGZvciBzbGFzaCBjb21tYW5kXG5cdCAqIEBwYXJhbSBhcmdzIC0gU2xhc2ggY29tbWFuZCBvcHRpb25zXG5cdCAqL1xuXHRwdWJsaWMgZXhlY1NsYXNoKG1lc3NhZ2U6IEFrYWlyb01lc3NhZ2UsIC4uLmFyZ3M6IGFueVtdKTogYW55IHtcblx0XHRpZiAodGhpcy5zbGFzaCkge1xuXHRcdFx0dGhyb3cgbmV3IEFrYWlyb0Vycm9yKFwiTk9UX0lNUExFTUVOVEVEXCIsIHRoaXMuY29uc3RydWN0b3IubmFtZSwgXCJleGVjU2xhc2hcIik7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFBhcnNlcyBjb250ZW50IHVzaW5nIHRoZSBjb21tYW5kJ3MgYXJndW1lbnRzLlxuXHQgKiBAcGFyYW0gbWVzc2FnZSAtIE1lc3NhZ2UgdG8gdXNlLlxuXHQgKiBAcGFyYW0gY29udGVudCAtIFN0cmluZyB0byBwYXJzZS5cblx0ICovXG5cdHB1YmxpYyBwYXJzZShtZXNzYWdlOiBNZXNzYWdlLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPEZsYWcgfCBhbnk+IHtcblx0XHRjb25zdCBwYXJzZWQgPSB0aGlzLmNvbnRlbnRQYXJzZXIucGFyc2UoY29udGVudCk7XG5cdFx0cmV0dXJuIHRoaXMuYXJndW1lbnRSdW5uZXIucnVuKG1lc3NhZ2UsIHBhcnNlZCwgdGhpcy5hcmd1bWVudEdlbmVyYXRvcik7XG5cdH1cblxuXHQvKipcblx0ICogUmVsb2FkcyB0aGUgY29tbWFuZC5cblx0ICovXG5cdHB1YmxpYyBvdmVycmlkZSByZWxvYWQoKTogUHJvbWlzZTxDb21tYW5kPiB7XG5cdFx0cmV0dXJuIHN1cGVyLnJlbG9hZCgpIGFzIFByb21pc2U8Q29tbWFuZD47XG5cdH1cblxuXHQvKipcblx0ICogUmVtb3ZlcyB0aGUgY29tbWFuZC5cblx0ICovXG5cdHB1YmxpYyBvdmVycmlkZSByZW1vdmUoKTogQ29tbWFuZCB7XG5cdFx0cmV0dXJuIHN1cGVyLnJlbW92ZSgpIGFzIENvbW1hbmQ7XG5cdH1cbn1cblxuLyoqXG4gKiBPcHRpb25zIHRvIHVzZSBmb3IgY29tbWFuZCBleGVjdXRpb24gYmVoYXZpb3IuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29tbWFuZE9wdGlvbnMgZXh0ZW5kcyBBa2Fpcm9Nb2R1bGVPcHRpb25zIHtcblx0LyoqXG5cdCAqIENvbW1hbmQgbmFtZXMuXG5cdCAqL1xuXHRhbGlhc2VzPzogc3RyaW5nW107XG5cblx0LyoqXG5cdCAqIEFyZ3VtZW50IG9wdGlvbnMgb3IgZ2VuZXJhdG9yLlxuXHQgKi9cblx0YXJncz86IEFyZ3VtZW50T3B0aW9uc1tdIHwgQXJndW1lbnRHZW5lcmF0b3I7XG5cblx0LyoqXG5cdCAqIFRoZSBkZWZhdWx0IGFyZ3VtZW50IG9wdGlvbnMuXG5cdCAqL1xuXHRhcmd1bWVudERlZmF1bHRzPzogRGVmYXVsdEFyZ3VtZW50T3B0aW9ucztcblxuXHQvKipcblx0ICogRnVuY3Rpb24gdG8gcnVuIGJlZm9yZSBhcmd1bWVudCBwYXJzaW5nIGFuZCBleGVjdXRpb24uXG5cdCAqL1xuXHRiZWZvcmU/OiBCZWZvcmVBY3Rpb247XG5cblx0LyoqXG5cdCAqIFJlc3RyaWN0cyBjaGFubmVsIHRvIGVpdGhlciAnZ3VpbGQnIG9yICdkbScuXG5cdCAqL1xuXHRjaGFubmVsPzogXCJndWlsZFwiIHwgXCJkbVwiO1xuXG5cdC8qKlxuXHQgKiBQZXJtaXNzaW9ucyByZXF1aXJlZCBieSB0aGUgY2xpZW50IHRvIHJ1biB0aGlzIGNvbW1hbmQuXG5cdCAqL1xuXHRjbGllbnRQZXJtaXNzaW9ucz86IFBlcm1pc3Npb25SZXNvbHZhYmxlIHwgUGVybWlzc2lvblJlc29sdmFibGVbXSB8IE1pc3NpbmdQZXJtaXNzaW9uU3VwcGxpZXI7XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IHRvIHJ1biBvbiBtZXNzYWdlcyB0aGF0IGFyZSBub3QgZGlyZWN0bHkgY29tbWFuZHMuXG5cdCAqL1xuXHRjb25kaXRpb24/OiBFeGVjdXRpb25QcmVkaWNhdGU7XG5cblx0LyoqXG5cdCAqIFRoZSBjb21tYW5kIGNvb2xkb3duIGluIG1pbGxpc2Vjb25kcy5cblx0ICovXG5cdGNvb2xkb3duPzogbnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBEZXNjcmlwdGlvbiBvZiB0aGUgY29tbWFuZC5cblx0ICovXG5cdGRlc2NyaXB0aW9uPzogc3RyaW5nIHwgYW55IHwgYW55W107XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IG1lc3NhZ2UgZWRpdHMgd2lsbCBydW4gdGhpcyBjb21tYW5kLlxuXHQgKi9cblx0ZWRpdGFibGU/OiBib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBGbGFncyB0byB1c2Ugd2hlbiB1c2luZyBhbiBBcmd1bWVudEdlbmVyYXRvclxuXHQgKi9cblx0ZmxhZ3M/OiBzdHJpbmdbXTtcblxuXHQvKipcblx0ICogSUQgb2YgdXNlcihzKSB0byBpZ25vcmUgY29vbGRvd24gb3IgYSBmdW5jdGlvbiB0byBpZ25vcmUuXG5cdCAqL1xuXHRpZ25vcmVDb29sZG93bj86IFNub3dmbGFrZSB8IFNub3dmbGFrZVtdIHwgSWdub3JlQ2hlY2tQcmVkaWNhdGU7XG5cblx0LyoqXG5cdCAqIElEIG9mIHVzZXIocykgdG8gaWdub3JlIGB1c2VyUGVybWlzc2lvbnNgIGNoZWNrcyBvciBhIGZ1bmN0aW9uIHRvIGlnbm9yZS5cblx0ICovXG5cdGlnbm9yZVBlcm1pc3Npb25zPzogU25vd2ZsYWtlIHwgU25vd2ZsYWtlW10gfCBJZ25vcmVDaGVja1ByZWRpY2F0ZTtcblxuXHQvKipcblx0ICogVGhlIGtleSB0eXBlIG9yIGtleSBnZW5lcmF0b3IgZm9yIHRoZSBsb2NrZXIuIElmIGxvY2sgaXMgYSBzdHJpbmcsIGl0J3MgZXhwZWN0ZWQgb25lIG9mICdndWlsZCcsICdjaGFubmVsJywgb3IgJ3VzZXInXG5cdCAqL1xuXHRsb2NrPzogS2V5U3VwcGxpZXIgfCBcImd1aWxkXCIgfCBcImNoYW5uZWxcIiB8IFwidXNlclwiO1xuXG5cdC8qKlxuXHQgKiBXaGV0aGVyIG9yIG5vdCB0byBvbmx5IGFsbG93IHRoZSBjb21tYW5kIHRvIGJlIHJ1biBpbiBOU0ZXIGNoYW5uZWxzLlxuXHQgKi9cblx0b25seU5zZnc/OiBib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBPcHRpb24gZmxhZ3MgdG8gdXNlIHdoZW4gdXNpbmcgYW4gQXJndW1lbnRHZW5lcmF0b3IuXG5cdCAqL1xuXHRvcHRpb25GbGFncz86IHN0cmluZ1tdO1xuXG5cdC8qKlxuXHQgKiBXaGV0aGVyIG9yIG5vdCB0byBhbGxvdyBjbGllbnQgb3duZXIocykgb25seS5cblx0ICovXG5cdG93bmVyT25seT86IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIFRoZSBwcmVmaXgoZXMpIHRvIG92ZXJ3cml0ZSB0aGUgZ2xvYmFsIG9uZSBmb3IgdGhpcyBjb21tYW5kLlxuXHQgKi9cblx0cHJlZml4Pzogc3RyaW5nIHwgc3RyaW5nW10gfCBQcmVmaXhTdXBwbGllcjtcblxuXHQvKipcblx0ICogV2hldGhlciBvciBub3QgdG8gY29uc2lkZXIgcXVvdGVzLlxuXHQgKi9cblx0cXVvdGVkPzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogQW1vdW50IG9mIGNvbW1hbmQgdXNlcyBhbGxvd2VkIHVudGlsIGNvb2xkb3duLlxuXHQgKi9cblx0cmF0ZWxpbWl0PzogbnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBBIHJlZ2V4IHRvIG1hdGNoIGluIG1lc3NhZ2VzIHRoYXQgYXJlIG5vdCBkaXJlY3RseSBjb21tYW5kcy4gVGhlIGFyZ3Mgb2JqZWN0IHdpbGwgaGF2ZSBgbWF0Y2hgIGFuZCBgbWF0Y2hlc2AgcHJvcGVydGllcy5cblx0ICovXG5cdHJlZ2V4PzogUmVnRXhwIHwgUmVnZXhTdXBwbGllcjtcblxuXHQvKipcblx0ICogQ3VzdG9tIHNlcGFyYXRvciBmb3IgYXJndW1lbnQgaW5wdXQuXG5cdCAqL1xuXHRzZXBhcmF0b3I/OiBzdHJpbmc7XG5cblx0LyoqXG5cdCAqIE1hcmsgY29tbWFuZCBhcyBzbGFzaCBjb21tYW5kIGFuZCBzZXQgaW5mb3JtYXRpb24uXG5cdCAqL1xuXHRzbGFzaD86IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgc2xhc2ggY29tbWFuZCByZXNwb25zZXMgZm9yIHRoaXMgY29tbWFuZCBzaG91bGQgYmUgZXBoZW1lcmFsIG9yIG5vdC5cblx0ICovXG5cdHNsYXNoRXBoZW1lcmFsPzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogQXNzaWduIHNsYXNoIGNvbW1hbmRzIHRvIFNwZWNpZmljIGd1aWxkcy4gVGhpcyBvcHRpb24gd2lsbCBtYWtlIHRoZSBjb21tYW5kcyBkbyBub3QgcmVnaXN0ZXIgZ2xvYmFsbHksIGJ1dCBvbmx5IHRvIHRoZSBjaG9zZW4gc2VydmVycy5cblx0ICovXG5cdHNsYXNoR3VpbGRzPzogc3RyaW5nW107XG5cblx0LyoqXG5cdCAqIE9wdGlvbnMgZm9yIHVzaW5nIHRoZSBzbGFzaCBjb21tYW5kLlxuXHQgKi9cblx0c2xhc2hPcHRpb25zPzogQXBwbGljYXRpb25Db21tYW5kT3B0aW9uRGF0YVtdO1xuXG5cdC8qKlxuXHQgKiBXaGV0aGVyIG9yIG5vdCB0byBhbGxvdyBjbGllbnQgc3VwZXJVc2VycyhzKSBvbmx5LlxuXHQgKi9cblx0c3VwZXJVc2VyT25seT86IGJvb2xlYW47XG5cblx0LyoqXG5cdCAqIFdoZXRoZXIgb3Igbm90IHRvIHR5cGUgaW4gY2hhbm5lbCBkdXJpbmcgZXhlY3V0aW9uLlxuXHQgKi9cblx0dHlwaW5nPzogYm9vbGVhbjtcblxuXHQvKipcblx0ICogUGVybWlzc2lvbnMgcmVxdWlyZWQgYnkgdGhlIHVzZXIgdG8gcnVuIHRoaXMgY29tbWFuZC5cblx0ICovXG5cdHVzZXJQZXJtaXNzaW9ucz86IFBlcm1pc3Npb25SZXNvbHZhYmxlIHwgUGVybWlzc2lvblJlc29sdmFibGVbXSB8IE1pc3NpbmdQZXJtaXNzaW9uU3VwcGxpZXI7XG5cblx0LyoqXG5cdCAqIE9ubHkgYWxsb3cgdGhpcyBjb21tYW5kIHRvIGJlIHVzZWQgYXMgYSBzbGFzaCBjb21tYW5kLiBBbHNvIG1ha2VzIGBzbGFzaGAgYHRydWVgXG5cdCAqL1xuXHRzbGFzaE9ubHk/OiBib29sZWFuO1xufVxuXG4vKipcbiAqIEEgZnVuY3Rpb24gdG8gcnVuIGJlZm9yZSBhcmd1bWVudCBwYXJzaW5nIGFuZCBleGVjdXRpb24uXG4gKiBAcGFyYW0gbWVzc2FnZSAtIE1lc3NhZ2UgdGhhdCB0cmlnZ2VyZWQgdGhlIGNvbW1hbmQuXG4gKi9cbmV4cG9ydCB0eXBlIEJlZm9yZUFjdGlvbiA9IChtZXNzYWdlOiBNZXNzYWdlKSA9PiBhbnk7XG5cbi8qKlxuICogQSBmdW5jdGlvbiB1c2VkIHRvIHN1cHBseSB0aGUga2V5IGZvciB0aGUgbG9ja2VyLlxuICogQHBhcmFtIG1lc3NhZ2UgLSBNZXNzYWdlIHRoYXQgdHJpZ2dlcmVkIHRoZSBjb21tYW5kLlxuICogQHBhcmFtIGFyZ3MgLSBFdmFsdWF0ZWQgYXJndW1lbnRzLlxuICovXG5leHBvcnQgdHlwZSBLZXlTdXBwbGllciA9IChtZXNzYWdlOiBNZXNzYWdlIHwgQWthaXJvTWVzc2FnZSwgYXJnczogYW55KSA9PiBzdHJpbmc7XG5cbi8qKlxuICogQSBmdW5jdGlvbiB1c2VkIHRvIGNoZWNrIGlmIHRoZSBjb21tYW5kIHNob3VsZCBydW4gYXJiaXRyYXJpbHkuXG4gKiBAcGFyYW0gbWVzc2FnZSAtIE1lc3NhZ2UgdG8gY2hlY2suXG4gKi9cbmV4cG9ydCB0eXBlIEV4ZWN1dGlvblByZWRpY2F0ZSA9IChtZXNzYWdlOiBNZXNzYWdlKSA9PiBib29sZWFuIHwgUHJvbWlzZTxib29sZWFuPjtcblxuLyoqXG4gKiBBIGZ1bmN0aW9uIHVzZWQgdG8gY2hlY2sgaWYgYSBtZXNzYWdlIGhhcyBwZXJtaXNzaW9ucyBmb3IgdGhlIGNvbW1hbmQuXG4gKiBBIG5vbi1udWxsIHJldHVybiB2YWx1ZSBzaWduaWZpZXMgdGhlIHJlYXNvbiBmb3IgbWlzc2luZyBwZXJtaXNzaW9ucy5cbiAqIEBwYXJhbSBtZXNzYWdlIC0gTWVzc2FnZSB0aGF0IHRyaWdnZXJlZCB0aGUgY29tbWFuZC5cbiAqL1xuZXhwb3J0IHR5cGUgTWlzc2luZ1Blcm1pc3Npb25TdXBwbGllciA9IChtZXNzYWdlOiBNZXNzYWdlIHwgQWthaXJvTWVzc2FnZSkgPT4gUHJvbWlzZTxhbnk+IHwgYW55O1xuXG4vKipcbiAqIEEgZnVuY3Rpb24gdXNlZCB0byByZXR1cm4gYSByZWd1bGFyIGV4cHJlc3Npb24uXG4gKiBAcGFyYW0gbWVzc2FnZSAtIE1lc3NhZ2UgdG8gZ2V0IHJlZ2V4IGZvci5cbiAqL1xuZXhwb3J0IHR5cGUgUmVnZXhTdXBwbGllciA9IChtZXNzYWdlOiBNZXNzYWdlKSA9PiBSZWdFeHA7XG5cbi8qKlxuICogR2VuZXJhdG9yIGZvciBhcmd1bWVudHMuXG4gKiBXaGVuIHlpZWxkaW5nIGFyZ3VtZW50IG9wdGlvbnMsIHRoYXQgYXJndW1lbnQgaXMgcmFuIGFuZCB0aGUgcmVzdWx0IG9mIHRoZSBwcm9jZXNzaW5nIGlzIGdpdmVuLlxuICogVGhlIGxhc3QgdmFsdWUgd2hlbiB0aGUgZ2VuZXJhdG9yIGlzIGRvbmUgaXMgdGhlIHJlc3VsdGluZyBgYXJnc2AgZm9yIHRoZSBjb21tYW5kJ3MgYGV4ZWNgLlxuICogQHBhcmFtIG1lc3NhZ2UgLSBNZXNzYWdlIHRoYXQgdHJpZ2dlcmVkIHRoZSBjb21tYW5kLlxuICogQHBhcmFtIHBhcnNlZCAtIFBhcnNlZCBjb250ZW50LlxuICogQHBhcmFtIHN0YXRlIC0gQXJndW1lbnQgcHJvY2Vzc2luZyBzdGF0ZS5cbiAqL1xuZXhwb3J0IHR5cGUgQXJndW1lbnRHZW5lcmF0b3IgPSAoXG5cdG1lc3NhZ2U6IE1lc3NhZ2UsXG5cdHBhcnNlZDogQ29udGVudFBhcnNlclJlc3VsdCxcblx0c3RhdGU6IEFyZ3VtZW50UnVubmVyU3RhdGVcbikgPT4gSXRlcmFibGVJdGVyYXRvcjxBcmd1bWVudE9wdGlvbnMgfCBGbGFnPjtcbiJdfQ==